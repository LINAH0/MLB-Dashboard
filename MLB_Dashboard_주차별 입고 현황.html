<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MLB ë‚©ê¸° ì£¼ì°¨ë³„ ëª©í‘œëŒ€ë¹„ ì…ê³ í˜„í™© ëŒ€ì‹œë³´ë“œ</title>
    <!-- SheetJS ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¶”ê°€ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <!-- Chart.js ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¶”ê°€ -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Malgun Gothic', 'ë§‘ì€ ê³ ë”•', Arial, sans-serif;
            background-color: #f8f9fa;
            color: #2c3e50;
            line-height: 1.6;
        }

        /* í—¤ë” */
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .header h1 {
            font-size: 2rem;
            font-weight: 700;
        }

        .header-info {
            text-align: right;
        }

        .current-week {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .date-range {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        /* ë©”ì¸ ì»¨í…Œì´ë„ˆ */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* ì»´íŒ©íŠ¸ ì—…ë¡œë“œ ì˜ì—­ */
        .compact-upload {
            background: rgba(255, 255, 255, 0.1);
            border: 1px dashed rgba(255, 255, 255, 0.3);
            border-radius: 6px;
            padding: 8px 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.85rem;
        }

        .compact-upload:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.5);
        }

        .compact-upload.dragover {
            background: rgba(46, 204, 113, 0.2);
            border-color: rgba(46, 204, 113, 0.5);
        }

        .upload-icon-small {
            font-size: 1rem;
        }

        .file-input {
            display: none;
        }

        /* í•„í„° ì„¹ì…˜ */
        .filter-section {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .filter-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 15px;
            color: #2c3e50;
        }

        .filter-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            align-items: end;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .filter-group label {
            font-weight: 600;
            color: #34495e;
            font-size: 0.9rem;
        }

        .filter-group select,
        .filter-group input {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 0.9rem;
        }

        /* ì£¼ì°¨ ì„ íƒê¸° */
        .week-selector {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .week-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .week-buttons {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s ease;
        }

        .btn-primary {
            background: #3498db;
            color: white;
        }

        .btn-primary:hover {
            background: #2980b9;
        }

        .btn-secondary {
            background: #95a5a6;
            color: white;
        }

        .btn-secondary:hover {
            background: #7f8c8d;
        }

        .btn-success {
            background: #27ae60;
            color: white;
        }

        .btn-success:hover {
            background: #229954;
        }

        .btn-warning {
            background: #f39c12;
            color: white;
        }

        .btn-warning:hover {
            background: #e67e22;
        }

        .week-info {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .week-select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 0.9rem;
        }

        /* KPI ì„¹ì…˜ */
        .kpi-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .kpi-card {
            background: white;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            border-left: 4px solid;
            transition: transform 0.2s ease;
        }

        .kpi-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }

        .kpi-card.target { border-left-color: #3498db; }
        .kpi-card.actual { border-left-color: #27ae60; }
        .kpi-card.achievement { border-left-color: #f39c12; }
        .kpi-card.variance { border-left-color: #e74c3c; }

        .kpi-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .kpi-title {
            font-size: 0.9rem;
            color: #7f8c8d;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .kpi-icon {
            font-size: 1.5rem;
            opacity: 0.7;
        }

        .kpi-value {
            font-size: 2.2rem;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .kpi-unit {
            font-size: 0.8rem;
            color: #7f8c8d;
        }

        .kpi-change {
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .kpi-change.positive { color: #27ae60; }
        .kpi-change.negative { color: #e74c3c; }

        /* ì°¨íŠ¸ ì„¹ì…˜ */
        .chart-section {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .chart-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .chart-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 15px;
            color: #2c3e50;
        }

        .chart-wrapper {
            position: relative;
            height: 300px;
        }

        /* ì„±ê³¼ íŒ¨ë„ ì„¹ì…˜ */
        .performance-panels {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .performance-panel {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            border: 1px solid #e9ecef;
        }

        .panel-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .panel-icon {
            width: 24px;
            height: 24px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            color: white;
        }

        .panel-icon.purple { background-color: #8e44ad; }
        .panel-icon.blue { background-color: #3498db; }
        .panel-icon.orange { background-color: #f39c12; }

        .panel-title {
            font-size: 1rem;
            font-weight: 600;
            color: #2c3e50;
        }

        .panel-content {
            font-size: 0.9rem;
            line-height: 1.6;
        }

        .performance-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #f8f9fa;
        }

        .performance-item:last-child {
            border-bottom: none;
        }

        .item-label {
            font-weight: 500;
            color: #34495e;
        }

        .item-value {
            font-weight: 600;
            color: #2c3e50;
        }

        .item-value.target {
            color: #3498db;
        }

        .target-text {
            color: #3498db;
        }

        .target-section {
            color: #3498db;
        }

        .item-value.high-risk {
            color: #e74c3c;
        }

        .item-value.no-data {
            color: #95a5a6;
            font-style: italic;
        }

        /* í…Œì´ë¸” ì„¹ì…˜ */
        .table-section {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .table-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #2c3e50;
        }

        .table-count {
            font-size: 0.9rem;
            color: #7f8c8d;
        }

        .table-wrapper {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }

        th, td {
            padding: 12px 8px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        th {
            background-color: #f8f9fa;
            font-weight: 600;
            color: #2c3e50;
            position: sticky;
            top: 0;
        }

        tr:hover {
            background-color: #f8f9fa;
        }

        .number {
            text-align: right;
        }

        .status-achieved { color: #27ae60; font-weight: 600; }
        .status-over { color: #e74c3c; font-weight: 600; }
        .status-under { color: #f39c12; font-weight: 600; }
        .status-pending { color: #95a5a6; font-weight: 600; }

        /* íƒ­ ìŠ¤íƒ€ì¼ */
        .tab-container {
            margin-bottom: 20px;
        }

        .tab-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .tab-button {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.2s ease;
            background-color: #f8f9fa;
            color: #6c757d;
        }

        .tab-button.active {
            background-color: #007bff;
            color: white;
        }

        .tab-button:hover {
            background-color: #e9ecef;
        }

        .tab-button.active:hover {
            background-color: #0056b3;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* ë°˜ì‘í˜• ë””ìì¸ */
        @media (max-width: 1200px) {
            .chart-section {
                grid-template-columns: 1fr 1fr;
            }
        }

        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 15px;
            }

            .chart-section {
                grid-template-columns: 1fr;
            }

            .filter-row {
                grid-template-columns: 1fr;
            }

            .week-nav {
                flex-direction: column;
                align-items: stretch;
            }

            .week-buttons {
                justify-content: center;
            }
        }

        /* ë¡œë”© ìŠ¤í”¼ë„ˆ */
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* ì•Œë¦¼ ë©”ì‹œì§€ */
        .alert {
            padding: 12px 16px;
            border-radius: 4px;
            margin-bottom: 20px;
            font-size: 0.9rem;
        }

        .alert-success {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }

        .alert-error {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }

        .alert-info {
            background-color: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }
    </style>
</head>
<body>
    <!-- í—¤ë” -->
    <header class="header">
        <div class="header-content">
            <h1 id="dashboardTitle">MLB ë‚©ê¸° ì£¼ì°¨ë³„ ëª©í‘œëŒ€ë¹„ ì…ê³ í˜„í™©</h1>
            <div class="header-right">
                <div class="compact-upload" onclick="document.getElementById('fileInput').click()">
                    <span class="upload-icon-small">ğŸ“</span>
                    <span>ì—‘ì…€ íŒŒì¼ ì—…ë¡œë“œ</span>
                </div>
                <input type="file" id="fileInput" class="file-input" accept=".xlsx,.xls" onchange="handleFileUpload(event)">
                <div class="header-info">
                    <div class="current-week" id="currentWeekDisplay">ë°ì´í„°ë¥¼ ì—…ë¡œë“œí•˜ì„¸ìš”</div>
                    <div class="date-range" id="dateRangeDisplay"></div>
                </div>
            </div>
        </div>
    </header>

    <!-- ë©”ì¸ ì»¨í…Œì´ë„ˆ -->
    <div class="container">
        <!-- ì•Œë¦¼ ë©”ì‹œì§€ ì˜ì—­ -->
        <div id="alertContainer"></div>

        <!-- ë¡œë”© ìŠ¤í”¼ë„ˆ -->
        <div class="loading" id="loadingSpinner">
            <div class="spinner"></div>
            <div>ë°ì´í„°ë¥¼ ì²˜ë¦¬ ì¤‘ì…ë‹ˆë‹¤...</div>
        </div>

        <!-- í•„í„° ì„¹ì…˜ -->
        <div class="filter-section" id="filterSection" style="display: none;">
            <div class="filter-title">í•„í„° ì˜µì…˜</div>
            <div class="filter-row">
                <div class="filter-group">
                    <label for="productFilter">ì œí’ˆêµ¬ë¶„</label>
                    <select id="productFilter" onchange="applyFilters()">
                        <option value="">ì „ì²´</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="countryFilter">íŒë§¤êµ­ê°€</label>
                    <select id="countryFilter" onchange="applyFilters()">
                        <option value="">ì „ì²´</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="vendorFilter">í˜‘ë ¥ì‚¬</label>
                    <select id="vendorFilter" onchange="applyFilters()">
                        <option value="">ì „ì²´</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="seasonFilter">ì‹œì¦Œ</label>
                    <select id="seasonFilter" onchange="applyFilters()">
                        <option value="">ì „ì²´</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="statusFilter">ìƒíƒœ</label>
                    <select id="statusFilter" onchange="applyFilters()">
                        <option value="">ì „ì²´</option>
                        <option value="achieved">ë‹¬ì„±</option>
                        <option value="over">ì´ˆê³¼</option>
                        <option value="under">ë¯¸ë‹¬</option>
                        <option value="pending">ì˜ˆì •</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- ì£¼ì°¨ ì„ íƒê¸° -->
        <div class="week-selector" id="weekSelector" style="display: none;">
            <div class="week-nav">
                <div class="week-buttons">
                    <button class="btn btn-secondary" onclick="navigateWeek(-1)">â—€ ì´ì „ì£¼</button>
                    <button class="btn btn-primary" onclick="navigateWeek(0)">í˜„ì¬ì£¼</button>
                    <button class="btn btn-secondary" onclick="navigateWeek(1)">ë‹¤ìŒì£¼ â–¶</button>
                </div>
                <div class="week-info">
                    <select id="weekSelect" class="week-select" onchange="selectWeek()">
                        <option value="">ì£¼ì°¨ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- KPI ì„¹ì…˜ -->
        <div class="kpi-section" id="kpiSection" style="display: none;">
            <div class="kpi-card target">
                <div class="kpi-header">
                    <div class="kpi-title">ëˆ„ì  ë°œì£¼</div>
                    <div class="kpi-icon">ğŸ¯</div>
                </div>
                <div class="kpi-value" id="totalTarget">0</div>
                <div class="kpi-unit">ê°œ</div>
            </div>
            <div class="kpi-card scheduled">
                <div class="kpi-header">
                    <div class="kpi-title">ëˆ„ì  ì¶œê³ </div>
                    <div class="kpi-icon">ğŸ“…</div>
                </div>
                <div class="kpi-value" id="totalScheduled">0</div>
                <div class="kpi-unit">ê°œ</div>
            </div>
            <div class="kpi-card achievement">
                <div class="kpi-header">
                    <div class="kpi-title">ì¶œê³  ë‹¬ì„±ë¥ </div>
                    <div class="kpi-icon">ğŸ“Š</div>
                </div>
                <div class="kpi-value" id="scheduledAchievementRate">0%</div>
                <div class="kpi-unit">ë°œì£¼ ëŒ€ë¹„</div>
            </div>
            <div class="kpi-card actual">
                <div class="kpi-header">
                    <div class="kpi-title">ì‹¤ì œ ì…ê³ </div>
                    <div class="kpi-icon">ğŸ“¦</div>
                </div>
                <div class="kpi-value" id="totalActual">0</div>
                <div class="kpi-unit">ê°œ</div>
            </div>
            <div class="kpi-card achievement">
                <div class="kpi-header">
                    <div class="kpi-title">ì‹¤ ì…ê³  ë‹¬ì„±ë¥ </div>
                    <div class="kpi-icon">ğŸ“Š</div>
                </div>
                <div class="kpi-value" id="actualAchievementRate">0%</div>
                <div class="kpi-unit">ë°œì£¼ ëŒ€ë¹„</div>
            </div>
        </div>

        <!-- ì„±ê³¼ íŒ¨ë„ ì„¹ì…˜ -->
        <div class="performance-panels" id="performancePanels" style="display: none;">
            <div class="performance-panel">
                <div class="panel-header">
                    <div class="panel-icon purple">ğŸ“Š</div>
                    <div class="panel-title">ì œí’ˆ êµ¬ë¶„ë³„ ì„±ê³¼</div>
                </div>
                <div class="panel-content" id="productPerformance">
                    <!-- ì œí’ˆë³„ ì„±ê³¼ ë°ì´í„°ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                </div>
            </div>
            
            <div class="performance-panel">
                <div class="panel-header">
                    <div class="panel-icon blue">ğŸŒ</div>
                    <div class="panel-title">íŒë§¤êµ­ê°€ë³„ í˜„í™©</div>
                </div>
                <div class="panel-content" id="countryStatus">
                    <!-- êµ­ê°€ë³„ í˜„í™© ë°ì´í„°ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                </div>
            </div>
            
            <div class="performance-panel">
                <div class="panel-header">
                    <div class="panel-icon orange">ğŸ¯</div>
                    <div class="panel-title">ì´ë²ˆ ì£¼ ëª©í‘œ ë‹¬ì„± ê³„íš</div>
                </div>
                <div class="panel-content" id="weeklyPlan">
                    <!-- ì´ë²ˆ ì£¼ ê³„íš ë°ì´í„°ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                </div>
            </div>
        </div>

        <!-- ì°¨íŠ¸ ì„¹ì…˜ -->
        <div class="chart-section" id="chartSection" style="display: none;">
            <div class="chart-container">
                <div class="chart-title">ì£¼ì°¨ë³„ ëˆ„ì  í˜„í™©</div>
                <div class="chart-wrapper">
                    <canvas id="weeklyChart"></canvas>
                </div>
            </div>
            <div class="chart-container">
                <div class="chart-title">ì œí’ˆë³„ í˜„í™©</div>
                <div class="chart-wrapper">
                    <canvas id="productChart"></canvas>
                </div>
            </div>
            <div class="chart-container">
                <div class="chart-title">íŒë§¤êµ­ê°€ë³„ í˜„í™©</div>
                <div class="chart-wrapper">
                    <canvas id="countryChart"></canvas>
                </div>
            </div>
        </div>

        <!-- í…Œì´ë¸” ì„¹ì…˜ -->
        <div class="table-section" id="tableSection" style="display: none;">
            <div class="table-header">
                <div class="table-title">ì£¼ì°¨ë³„ ìƒì„¸ í˜„í™©</div>
                <div class="table-count" id="tableCount"></div>
            </div>
            
            <!-- íƒ­ ì»¨í…Œì´ë„ˆ -->
            <div class="tab-container">
                <div class="tab-buttons">
                    <button class="tab-button active" onclick="switchTab('all')">ì „ì²´ í˜„í™©</button>
                    <button class="tab-button" onclick="switchTab('delay')">DELAY ì´ìŠˆë§Œ ë³´ê¸°</button>
                </div>
                
                <!-- ì „ì²´ í˜„í™© íƒ­ -->
                <div class="tab-content active" id="allTab">
                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>ì£¼ì°¨</th>
                                    <th>ì œí’ˆêµ¬ë¶„</th>
                                    <th>íŒë§¤êµ­ê°€</th>
                                    <th>í˜‘ë ¥ì‚¬</th>
                                    <th>ì‹œì¦Œ</th>
                                    <th class="number">ëˆ„ì  ë°œì£¼</th>
                                    <th class="number">ëˆ„ì  ì¶œê³ </th>
                                    <th class="number">ëˆ„ì  ì…ê³ </th>
                                    <th class="number">ë‹¬ì„±ë¥ </th>
                                    <th class="number">ì°¨ì´</th>
                                    <th>ìƒíƒœ</th>
                                </tr>
                            </thead>
                            <tbody id="tableBody">
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- DELAY ì´ìŠˆ íƒ­ -->
                <div class="tab-content" id="delayTab">
                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>ì£¼ì°¨</th>
                                    <th>ì œí’ˆêµ¬ë¶„</th>
                                    <th>íŒë§¤êµ­ê°€</th>
                                    <th>í˜‘ë ¥ì‚¬</th>
                                    <th>ì‹œì¦Œ</th>
                                    <th class="number">ëˆ„ì  ë°œì£¼</th>
                                    <th class="number">ëˆ„ì  ì¶œê³ </th>
                                    <th class="number">ëˆ„ì  ì…ê³ </th>
                                    <th class="number">ë‹¬ì„±ë¥ </th>
                                    <th class="number">ì°¨ì´</th>
                                    <th>ìƒíƒœ</th>
                                </tr>
                            </thead>
                            <tbody id="delayTableBody">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let uploadedData = [];
        let filteredData = [];
        let currentWeek = null;
        let currentYear = null;
        let currentSeason = 'default'; // í˜„ì¬ ì‹œì¦Œ ì¶”ê°€
        let startYear = null; // ì‹œì‘ ì£¼ì°¨ (ë…„ë„)
        let startWeek = null; // ì‹œì‘ ì£¼ì°¨ (ì£¼ì°¨)
        let weeklyChart = null;
        let productChart = null;
        let countryChart = null;

        // íŒŒì¼ëª…ì—ì„œ ì‹œì¦Œ ì¶”ì¶œ
        function extractSeasonFromFilename(filename) {
            const fileName = filename.toLowerCase();
            
            if (fileName.includes('25fw') || fileName.includes('25 fw')) {
                return '25FW';
            } else if (fileName.includes('26ss') || fileName.includes('26 ss')) {
                return '26SS';
            } else if (fileName.includes('fw') || fileName.includes('fall') || fileName.includes('winter')) {
                return '25FW';
            } else if (fileName.includes('ss') || fileName.includes('spring') || fileName.includes('summer')) {
                return '26SS';
            }
            
            return 'default';
        }

        // ëŒ€ì‹œë³´ë“œ í—¤ë” ì—…ë°ì´íŠ¸ (ê°•í™”ëœ ë²„ì „)
        function updateDashboardHeader(season) {
            const headerElement = document.getElementById('dashboardTitle');
            if (headerElement) {
                let seasonText = '';
                switch(season) {
                    case '25FW':
                        seasonText = '25FW MLB ë‚©ê¸° ì£¼ì°¨ë³„ ëª©í‘œëŒ€ë¹„ ì…ê³ í˜„í™©';
                        break;
                    case '26SS':
                        seasonText = '26SS MLB ë‚©ê¸° ì£¼ì°¨ë³„ ëª©í‘œëŒ€ë¹„ ì…ê³ í˜„í™©';
                        break;
                    default:
                        seasonText = 'MLB ë‚©ê¸° ì£¼ì°¨ë³„ ëª©í‘œëŒ€ë¹„ ì…ê³ í˜„í™©';
                        break;
                }
                headerElement.textContent = seasonText;
                
                // í˜ì´ì§€ ì œëª©ë„ ì—…ë°ì´íŠ¸
                document.title = seasonText + ' ëŒ€ì‹œë³´ë“œ';
            } else {
                // ëŒ€ì•ˆì ì¸ ë°©ë²•ìœ¼ë¡œ í—¤ë” ì°¾ê¸°
                const alternativeHeader = document.querySelector('h1') || document.querySelector('.header h1') || document.querySelector('.title');
                if (alternativeHeader) {
                    let seasonText = '';
                    switch(season) {
                        case '25FW':
                            seasonText = '25FW MLB ë‚©ê¸° ì£¼ì°¨ë³„ ëª©í‘œëŒ€ë¹„ ì…ê³ í˜„í™©';
                            break;
                        case '26SS':
                            seasonText = '26SS MLB ë‚©ê¸° ì£¼ì°¨ë³„ ëª©í‘œëŒ€ë¹„ ì…ê³ í˜„í™©';
                            break;
                        default:
                            seasonText = 'MLB ë‚©ê¸° ì£¼ì°¨ë³„ ëª©í‘œëŒ€ë¹„ ì…ê³ í˜„í™©';
                            break;
                    }
                    alternativeHeader.textContent = seasonText;
                }
            }
        }

        // íŒë§¤êµ­ê°€ ë§¤í•‘ ê·œì¹™
        const countryMapping = {
            'KR': ['KR', 'KOR', 'KOREA', 'í•œêµ­'],
            'CN': ['CN', 'CHN', 'CHINA', 'ì¤‘êµ­'],
            'GL': ['GL', 'GLOBAL', 'ê¸€ë¡œë²Œ'],
            'GL_ì§ì†¡': [] // KR, CN, GLì„ ì œì™¸í•œ ëª¨ë“  êµ­ê°€
        };

        // ì‹œì¦Œë³„ í—¤ë” ë§¤í•‘ ê·œì¹™
        const seasonHeaderMapping = {
            '25FW': {
                deliveryWeek: ['25FW ì£¼ì°¨', 'FW ì£¼ì°¨', 'Fall Week', 'Winter Week', '25FW', 'FW', 'Fall', 'Winter', 'Fall/Winter', '25FW Week', 'FW Week', 'ë‚©ê¸°ì£¼ì°¨', 'ë‚©ê¸° ì£¼ì°¨', 'ì£¼ì°¨', 'Week', 'ISO Week', 'ISOWeek', 'WEEK', 'Wk', 'wk', 'WEEK NO', 'Week No', 'ì£¼ì°¨ë²ˆí˜¸', 'ë‚©ê¸°ì£¼ì°¨ë²ˆí˜¸'],
                targetDate: ['25FW ë‚©ê¸°ì¼', 'FW ë‚©ê¸°ì¼', 'Fall ë‚©ê¸°ì¼', 'Winter ë‚©ê¸°ì¼', '25FW ETD', 'FW ETD', 'Fall ETD', 'Winter ETD', 'PO í•©ì˜ë‚©ê¸°ì¼', 'POí•©ì˜ë‚©ê¸°ì¼', 'í•©ì˜ë‚©ê¸°ì¼', 'ë‚©ê¸°ì¼', 'ETD Date', 'ë‚ ì§œ', 'ETD', 'Delivery Date', 'ë‚©ê¸°ë‚ ì§œ', 'ë‚©ê¸°ì¼ì'],
                targetQty: ['25FW ë°œì£¼', 'FW ë°œì£¼', 'Fall ë°œì£¼', 'Winter ë°œì£¼', '25FW ëª©í‘œ', 'FW ëª©í‘œ', 'Fall ëª©í‘œ', 'Winter ëª©í‘œ', '25FW Target', 'FW Target', 'Fall Target', 'Winter Target', '25FW ìˆ˜ëŸ‰', 'FW ìˆ˜ëŸ‰', 'Fall ìˆ˜ëŸ‰', 'Winter ìˆ˜ëŸ‰', 'ë°œì£¼ ìˆ˜ëŸ‰', 'ë°œì£¼ìˆ˜ëŸ‰', 'ë°œì£¼ëŸ‰', 'ëª©í‘œ', 'Target', 'Total Target', 'Total Qty', 'Order Qty', 'Order Quantity', 'ë°œì£¼ëŸ‰', 'ëª©í‘œëŸ‰', 'ê³„íšëŸ‰'],
                actualQty: ['25FW ì…ê³ ', 'FW ì…ê³ ', 'Fall ì…ê³ ', 'Winter ì…ê³ ', '25FW ì‹¤ì œ', 'FW ì‹¤ì œ', 'Fall ì‹¤ì œ', 'Winter ì‹¤ì œ', '25FW Actual', 'FW Actual', 'Fall Actual', 'Winter Actual', '25FW ì••ê³ ', 'FW ì••ê³ ', 'Fall ì••ê³ ', 'Winter ì••ê³ ', 'ì••ê³ ëŸ‰', 'ì…ê³ ëŸ‰', 'ì‹¤ì œì…ê³ ', 'ì…ê³ ìˆ˜ëŸ‰', 'ì‹¤ì…ê³ ', 'Actual in', 'Actual', 'Received Qty', 'Received Quantity', 'ì‹¤ì œëŸ‰', 'ì™„ë£ŒëŸ‰'],
                category: ['25FW ì œí’ˆ', 'FW ì œí’ˆ', 'Fall ì œí’ˆ', 'Winter ì œí’ˆ', '25FW êµ¬ë¶„', 'FW êµ¬ë¶„', 'Fall êµ¬ë¶„', 'Winter êµ¬ë¶„', '25FW Category', 'FW Category', 'Fall Category', 'Winter Category', 'ì œí’ˆêµ¬ë¶„', 'Category', 'êµ¬ë¶„', 'Product Type', 'ì œí’ˆìœ í˜•', 'ì œí’ˆë¶„ë¥˜'],
                country: ['25FW êµ­ê°€', 'FW êµ­ê°€', 'Fall êµ­ê°€', 'Winter êµ­ê°€', '25FW íŒë§¤êµ­ê°€', 'FW íŒë§¤êµ­ê°€', 'Fall íŒë§¤êµ­ê°€', 'Winter íŒë§¤êµ­ê°€', '25FW Country', 'FW Country', 'Fall Country', 'Winter Country', 'íŒë§¤êµ­ê°€', 'Country', 'Market', 'Region', 'íŒë§¤ì§€ì—­', 'ì‹œì¥'],
                vendor: ['25FW í˜‘ë ¥ì‚¬', 'FW í˜‘ë ¥ì‚¬', 'Fall í˜‘ë ¥ì‚¬', 'Winter í˜‘ë ¥ì‚¬', '25FW ì—…ì²´', 'FW ì—…ì²´', 'Fall ì—…ì²´', 'Winter ì—…ì²´', '25FW Vendor', 'FW Vendor', 'Fall Vendor', 'Winter Vendor', 'í˜‘ë ¥ì‚¬', 'Vendor', 'í˜‘ë ¥ì—…ì²´', 'Supplier', 'ê³µê¸‰ì—…ì²´', 'ì œì¡°ì—…ì²´'],
                season: ['25FW', 'FW', 'Fall', 'Winter', 'Fall/Winter', '25FW ì‹œì¦Œ', 'FW ì‹œì¦Œ', 'Fall ì‹œì¦Œ', 'Winter ì‹œì¦Œ', '25FW Season', 'FW Season', 'Fall Season', 'Winter Season', 'Season', 'ì‹œì¦Œ', 'Collection', 'ì»¬ë ‰ì…˜']
            },
            '26SS': {
                deliveryWeek: ['26SS ì£¼ì°¨', 'SS ì£¼ì°¨', 'Spring Week', 'Summer Week', '26SS', 'SS', 'Spring', 'Summer', 'Spring/Summer', '26SS Week', 'SS Week', 'ë‚©ê¸°ì£¼ì°¨', 'ë‚©ê¸° ì£¼ì°¨', 'ì£¼ì°¨', 'Week', 'ISO Week', 'ISOWeek'],
                targetDate: ['26SS ë‚©ê¸°ì¼', 'SS ë‚©ê¸°ì¼', 'Spring ë‚©ê¸°ì¼', 'Summer ë‚©ê¸°ì¼', '26SS ETD', 'SS ETD', 'Spring ETD', 'Summer ETD', 'PO í•©ì˜ë‚©ê¸°ì¼', 'POí•©ì˜ë‚©ê¸°ì¼', 'í•©ì˜ë‚©ê¸°ì¼', 'ë‚©ê¸°ì¼', 'ETD Date', 'ë‚ ì§œ'],
                targetQty: ['26SS ë°œì£¼', 'SS ë°œì£¼', 'Spring ë°œì£¼', 'Summer ë°œì£¼', '26SS ëª©í‘œ', 'SS ëª©í‘œ', 'Spring ëª©í‘œ', 'Summer ëª©í‘œ', '26SS Target', 'SS Target', 'Spring Target', 'Summer Target', '26SS ìˆ˜ëŸ‰', 'SS ìˆ˜ëŸ‰', 'Spring ìˆ˜ëŸ‰', 'Summer ìˆ˜ëŸ‰', 'ë°œì£¼ ìˆ˜ëŸ‰', 'ë°œì£¼ìˆ˜ëŸ‰', 'ë°œì£¼ëŸ‰', 'ëª©í‘œ', 'Target', 'Total Target', 'Total Qty'],
                actualQty: ['26SS ì…ê³ ', 'SS ì…ê³ ', 'Spring ì…ê³ ', 'Summer ì…ê³ ', '26SS ì‹¤ì œ', 'SS ì‹¤ì œ', 'Spring ì‹¤ì œ', 'Summer ì‹¤ì œ', '26SS Actual', 'SS Actual', 'Spring Actual', 'Summer Actual', '26SS ì••ê³ ', 'SS ì••ê³ ', 'Spring ì••ê³ ', 'Summer ì••ê³ ', 'ì••ê³ ëŸ‰', 'ì…ê³ ëŸ‰', 'ì‹¤ì œì…ê³ ', 'ì…ê³ ìˆ˜ëŸ‰', 'ì‹¤ì…ê³ ', 'Actual in', 'Actual'],
                category: ['26SS ì œí’ˆ', 'SS ì œí’ˆ', 'Spring ì œí’ˆ', 'Summer ì œí’ˆ', '26SS êµ¬ë¶„', 'SS êµ¬ë¶„', 'Spring êµ¬ë¶„', 'Summer êµ¬ë¶„', '26SS Category', 'SS Category', 'Spring Category', 'Summer Category', 'ì œí’ˆêµ¬ë¶„', 'Category', 'êµ¬ë¶„'],
                country: ['26SS êµ­ê°€', 'SS êµ­ê°€', 'Spring êµ­ê°€', 'Summer êµ­ê°€', '26SS íŒë§¤êµ­ê°€', 'SS íŒë§¤êµ­ê°€', 'Spring íŒë§¤êµ­ê°€', 'Summer íŒë§¤êµ­ê°€', '26SS Country', 'SS Country', 'Spring Country', 'Summer Country', 'íŒë§¤êµ­ê°€', 'Country'],
                vendor: ['26SS í˜‘ë ¥ì‚¬', 'SS í˜‘ë ¥ì‚¬', 'Spring í˜‘ë ¥ì‚¬', 'Summer í˜‘ë ¥ì‚¬', '26SS ì—…ì²´', 'SS ì—…ì²´', 'Spring ì—…ì²´', 'Summer ì—…ì²´', '26SS Vendor', 'SS Vendor', 'Spring Vendor', 'Summer Vendor', 'í˜‘ë ¥ì‚¬', 'Vendor', 'í˜‘ë ¥ì—…ì²´'],
                season: ['26SS', 'SS', 'Spring', 'Summer', 'Spring/Summer', '26SS ì‹œì¦Œ', 'SS ì‹œì¦Œ', 'Spring ì‹œì¦Œ', 'Summer ì‹œì¦Œ', '26SS Season', 'SS Season', 'Spring Season', 'Summer Season', 'Season', 'ì‹œì¦Œ']
            },
            'default': {
                deliveryWeek: ['ë‚©ê¸°ì£¼ì°¨', 'ë‚©ê¸° ì£¼ì°¨', 'ì£¼ì°¨', 'Week', 'ISO Week', 'ISOWeek'],
                targetDate: ['PO í•©ì˜ë‚©ê¸°ì¼', 'POí•©ì˜ë‚©ê¸°ì¼', 'í•©ì˜ë‚©ê¸°ì¼', 'ë‚©ê¸°ì¼', 'ETD Date', 'ë‚ ì§œ'],
                targetQty: ['ë°œì£¼ ìˆ˜ëŸ‰', 'ë°œì£¼ìˆ˜ëŸ‰', 'ë°œì£¼ëŸ‰', 'ëª©í‘œ', 'Target', 'Total Target', 'Total Qty'],
                actualQty: ['ì••ê³ ëŸ‰', 'ì…ê³ ëŸ‰', 'ì‹¤ì œì…ê³ ', 'ì…ê³ ìˆ˜ëŸ‰', 'ì‹¤ì…ê³ ', 'Actual in', 'Actual'],
                category: ['ì œí’ˆêµ¬ë¶„', 'Category', 'êµ¬ë¶„'],
                country: ['íŒë§¤êµ­ê°€', 'Country'],
                vendor: ['í˜‘ë ¥ì‚¬', 'Vendor', 'í˜‘ë ¥ì—…ì²´'],
                season: ['Season', 'ì‹œì¦Œ']
            }
        };

        // í—¤ë” ë§¤í•‘ ê·œì¹™
        const headerMapping = {
            deliveryWeek: ['ë‚©ê¸°ì£¼ì°¨', 'ë‚©ê¸° ì£¼ì°¨', 'ì£¼ì°¨', 'Week', 'ISO Week', 'ISOWeek'],
            targetDate: ['PO í•©ì˜ë‚©ê¸°ì¼', 'POí•©ì˜ë‚©ê¸°ì¼', 'í•©ì˜ë‚©ê¸°ì¼', 'ë‚©ê¸°ì¼', 'ETD Date', 'ë‚ ì§œ'],
            targetQty: ['ë°œì£¼ ìˆ˜ëŸ‰', 'ë°œì£¼ìˆ˜ëŸ‰', 'ë°œì£¼ëŸ‰', 'ëª©í‘œ', 'Target', 'Total Target', 'Total Qty'],
            actualQty: ['ì••ê³ ëŸ‰', 'ì…ê³ ëŸ‰', 'ì‹¤ì œì…ê³ ', 'ì…ê³ ìˆ˜ëŸ‰', 'ì‹¤ì…ê³ ', 'Actual in', 'Actual'],
            category: ['ì œí’ˆêµ¬ë¶„', 'Category', 'êµ¬ë¶„'],
            country: ['íŒë§¤êµ­ê°€', 'Country'],
            vendor: ['í˜‘ë ¥ì‚¬', 'Vendor', 'í˜‘ë ¥ì—…ì²´'],
            season: ['Season', 'ì‹œì¦Œ']
        };

        // íŒŒì¼ ì—…ë¡œë“œ ì²˜ë¦¬ (ì‹œì¦Œë³„ ìë™ ë§¤ì¹­)
        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            showLoading(true);
            showAlert('íŒŒì¼ì„ ì²˜ë¦¬ ì¤‘ì…ë‹ˆë‹¤...', 'info');

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    
                    // "ìƒì‚°í˜„í™©" ì‹œíŠ¸ ì°¾ê¸°
                    const targetSheetName = 'ìƒì‚°í˜„í™©';
                    let sheetName = null;
                    let worksheet = null;
                    
                    // ì‹œíŠ¸ ì´ë¦„ì´ ì •í™•íˆ "ìƒì‚°í˜„í™©"ì¸ ì‹œíŠ¸ ì°¾ê¸°
                    for (let i = 0; i < workbook.SheetNames.length; i++) {
                        if (workbook.SheetNames[i] === targetSheetName) {
                            sheetName = workbook.SheetNames[i];
                            worksheet = workbook.Sheets[sheetName];
                            break;
                        }
                    }
                    
                    // "ìƒì‚°í˜„í™©" ì‹œíŠ¸ê°€ ì—†ìœ¼ë©´ ì˜¤ë¥˜
                    if (!sheetName || !worksheet) {
                        throw new Error(`"${targetSheetName}" ì‹œíŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. íŒŒì¼ì— "${targetSheetName}" ì‹œíŠ¸ê°€ ìˆëŠ”ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.`);
                    }
                    
                    const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });

                    // íŒŒì¼ëª…ì—ì„œ ì‹œì¦Œ ì¶”ì¶œ
                    const detectedSeason = extractSeasonFromFilename(file.name);
                    currentSeason = detectedSeason; // ì „ì—­ ë³€ìˆ˜ì— ì €ì¥

                    if (jsonData.length < 2) {
                        throw new Error('ë°ì´í„°ê°€ ì¶©ë¶„í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                    }

                    processExcelData(jsonData);
                    updateDashboardHeader(detectedSeason); // í—¤ë” ì—…ë°ì´íŠ¸
                    showAlert(`${detectedSeason} ì‹œì¦Œ ë°ì´í„°ê°€ ì„±ê³µì ìœ¼ë¡œ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success');
                } catch (error) {
                    showAlert('íŒŒì¼ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message, 'error');
                } finally {
                    showLoading(false);
                }
            };

            reader.readAsArrayBuffer(file);
        }

        // ì—‘ì…€ ë°ì´í„° ì²˜ë¦¬ (ì‹œì¦Œë³„ í—¤ë” ë§¤í•‘)
        function processExcelData(jsonData) {
            const headers = jsonData[0];
            const rows = jsonData.slice(1);

            // ì‹œì¦Œë³„ í—¤ë” ë§¤í•‘ ì„ íƒ
            const headerMapping = seasonHeaderMapping[currentSeason] || seasonHeaderMapping['default'];
            
            // í—¤ë” ë§¤í•‘
            const mappedHeaders = mapHeaders(headers, headerMapping);
            
            // ì…ê³  ì˜ˆì •ìˆ˜ëŸ‰ ì»¬ëŸ¼ ì°¾ê¸° (1ì°¨, 2ì°¨, 3ì°¨, 4ì°¨, 5ì°¨ë§Œ ì¸ì‹)
            const scheduledQtyIndices = [];
            headers.forEach((header, index) => {
                const headerStr = String(header).trim().toLowerCase();
                
                // 1ì°¨, 2ì°¨, 3ì°¨, 4ì°¨, 5ì°¨ ì…ê³ ì˜ˆì •ìˆ˜ëŸ‰ë§Œ ì¸ì‹
                // "1ì°¨ ì…ê³ ì˜ˆì •", "2ì°¨ ì…ê³ ì˜ˆì •", "1ì°¨ì…ê³ ì˜ˆì •ìˆ˜ëŸ‰" ë“± íŒ¨í„´
                const isScheduledQty = 
                    headerStr.includes('1ì°¨') || headerStr.includes('2ì°¨') || 
                    headerStr.includes('3ì°¨') || headerStr.includes('4ì°¨') || 
                    headerStr.includes('5ì°¨');
                
                if (isScheduledQty) {
                    // ì…ê³ ì˜ˆì • ë˜ëŠ” ì˜ˆì •ìˆ˜ëŸ‰ ê´€ë ¨ í‚¤ì›Œë“œê°€ í¬í•¨ë˜ì–´ì•¼ í•¨
                    const hasScheduledKeyword = 
                        headerStr.includes('ì…ê³ ì˜ˆì •') || headerStr.includes('ì…ê³  ì˜ˆì •') || 
                        headerStr.includes('ì˜ˆì •ìˆ˜ëŸ‰') || headerStr.includes('ì˜ˆì •ëŸ‰') ||
                        (headerStr.includes('ì˜ˆì •') && (headerStr.includes('ì…ê³ ') || headerStr.includes('ìˆ˜ëŸ‰')));
                    
                    if (hasScheduledKeyword) {
                        // ì‹¤ì œ ì…ê³ (actualQty)ê°€ ì•„ë‹Œ ì˜ˆì •ìˆ˜ëŸ‰ë§Œ í¬í•¨
                        if (!headerStr.includes('ì‹¤ì œ') && !headerStr.includes('actual') && 
                            !headerStr.includes('ì••ê³ ') && !headerStr.includes('ì‹¤ì…ê³ ')) {
                            scheduledQtyIndices.push(index);
                        }
                    }
                }
            });
            
            // scheduledQtyë¥¼ ë°°ì—´ë¡œ ì„¤ì • (ì—¬ëŸ¬ ì»¬ëŸ¼ ì¸ë±ìŠ¤)
            if (scheduledQtyIndices.length > 0) {
                mappedHeaders.scheduledQty = scheduledQtyIndices;
            } else {
                mappedHeaders.scheduledQty = [];
            }
            
            // ë§¤í•‘ ì‹¤íŒ¨í•œ í—¤ë” í™•ì¸
            const mappedIndices = Object.values(mappedHeaders).flat().filter(idx => idx !== -1 && !Array.isArray(idx));
            const unmappedHeaders = headers.filter((header, index) => {
                return !mappedIndices.includes(index) && !scheduledQtyIndices.includes(index);
            });
            
            // í•„ìˆ˜ í•„ë“œ ë§¤í•‘ í™•ì¸
            const requiredFields = ['deliveryWeek', 'targetQty', 'actualQty'];
            const missingFields = requiredFields.filter(field => mappedHeaders[field] === -1);
            if (missingFields.length > 0) {
                
                // ìƒì„¸í•œ í•´ê²° ë°©ë²• ì œì‹œ
                let solutionMessage = `í•„ìˆ˜ í•„ë“œ ë§¤í•‘ ì‹¤íŒ¨ (${currentSeason} ì‹œì¦Œ):\n\n`;
                missingFields.forEach(field => {
                    switch(field) {
                        case 'deliveryWeek':
                            solutionMessage += 'â€¢ ë‚©ê¸° ì£¼ì°¨: "ì£¼ì°¨", "Week", "ë‚©ê¸°" ë“±ì´ í¬í•¨ëœ ì»¬ëŸ¼ì´ í•„ìš”í•©ë‹ˆë‹¤.\n';
                            break;
                        case 'targetQty':
                            solutionMessage += 'â€¢ ë°œì£¼ ìˆ˜ëŸ‰: "ë°œì£¼", "ëª©í‘œ", "Target" ë“±ì´ í¬í•¨ëœ ì»¬ëŸ¼ì´ í•„ìš”í•©ë‹ˆë‹¤.\n';
                            break;
                        case 'actualQty':
                            solutionMessage += 'â€¢ ì…ê³  ìˆ˜ëŸ‰: "ì…ê³ ", "ì‹¤ì œ", "Actual" ë“±ì´ í¬í•¨ëœ ì»¬ëŸ¼ì´ í•„ìš”í•©ë‹ˆë‹¤.\n';
                            break;
                    }
                });
                solutionMessage += `\n${currentSeason} ì‹œì¦Œì— ë§ëŠ” í—¤ë”ë¥¼ ì‚¬ìš©í•˜ê±°ë‚˜ íŒŒì¼ëª…ì— ì‹œì¦Œ ì •ë³´ë¥¼ í¬í•¨í•´ì£¼ì„¸ìš”.`;
                
                throw new Error(`í•„ìˆ˜ í•„ë“œê°€ ë§¤í•‘ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤: ${missingFields.join(', ')}. ${currentSeason} ì‹œì¦Œ í—¤ë”ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.`);
            }
            
            // ë°ì´í„° ë³€í™˜ (PO í•©ì˜ë‚©ê¸°ì¼ ê¸°ì¤€ ISO Week ìë™ ê³„ì‚°)
            uploadedData = rows.map((row, index) => {
                const item = {};
                let hasValidDeliveryWeek = false;
                
                // ë¨¼ì € ëª¨ë“  ê¸°ë³¸ ë°ì´í„°ë¥¼ ì²˜ë¦¬
                Object.keys(mappedHeaders).forEach(key => {
                    const headerIndex = mappedHeaders[key];
                    
                    // scheduledQtyëŠ” ë°°ì—´ë¡œ ì²˜ë¦¬ (ì—¬ëŸ¬ ì»¬ëŸ¼ì˜ í•©ê³„)
                    if (key === 'scheduledQty' && Array.isArray(headerIndex)) {
                        let totalScheduled = 0;
                        headerIndex.forEach(idx => {
                            if (idx !== -1 && row[idx] !== undefined) {
                                const value = parseNumber(row[idx]);
                                totalScheduled += value || 0;
                            }
                        });
                        item.scheduledQty = totalScheduled;
                    } else if (headerIndex !== -1 && row[headerIndex] !== undefined) {
                        let value = row[headerIndex];
                        
                        // ìˆ«ì ë°ì´í„° ì²˜ë¦¬ (ì½¤ë§ˆ ì œê±°)
                        if (['targetQty', 'actualQty'].includes(key)) {
                            value = parseNumber(value);
                        }
                        
                        // ëª©í‘œ ë‚ ì§œ ì²˜ë¦¬ (PO í•©ì˜ë‚©ê¸°ì¼) - ë¨¼ì € ì²˜ë¦¬
                        if (key === 'targetDate' && value) {
                            const date = parseDate(value);
                            if (date) {
                                item.targetDate = date;
                                item.targetWeek = getWeekNumber(date);
                                item.targetYear = date.getFullYear();
                            }
                        }
                        
                        item[key] = value;
                    }
                });
                
                // ë‚©ê¸° ì£¼ì°¨ ì²˜ë¦¬ (ì…ë ¥ëœ ìˆ«ì ê¸°ì¤€ìœ¼ë¡œ ì£¼ì°¨ ì„¤ì •)
                const deliveryWeekIndex = mappedHeaders.deliveryWeek;
                if (deliveryWeekIndex !== -1 && row[deliveryWeekIndex] !== undefined) {
                    const weekValue = row[deliveryWeekIndex];
                    const week = convertToWeekNumber(weekValue);
                    
                    // ì¡°ì •ëœ ì£¼ì°¨ ë²ˆí˜¸ í—ˆìš© (ì…ë ¥ëœ ìˆ«ì ê¸°ì¤€)
                    if (week > 0 && week <= 53) {
                        // ì‹œì¦Œë³„ ì£¼ì°¨ ë²”ìœ„ ê²€ì¦
                        const year = getYearFromDeliveryWeek(week);
                        if (year && isValidWeekForSeason(week, year)) {
                            item.deliveryWeek = week;
                            item.deliveryYear = year;
                            hasValidDeliveryWeek = true;
                        } else {
                            return null;
                        }
                    } else {
                        return null;
                    }
                } else {
                    return null;
                }
                
                // ìœ íš¨í•œ ë‚©ê¸° ì£¼ì°¨ê°€ ì—†ìœ¼ë©´ ì œì™¸
                if (!hasValidDeliveryWeek) {
                    return null;
                }
                
                // íŒë§¤êµ­ê°€ ë§¤í•‘ ì ìš©
                if (item.country) {
                    item.mappedCountry = mapCountry(item.country);
                } else {
                    item.mappedCountry = 'GL_ì§ì†¡';
                }
                
                // ê¸°ë³¸ê°’ ì„¤ì • (ëˆ„ë½ëœ í•„ë“œ ì²˜ë¦¬)
                item.targetQty = item.targetQty || 0;
                item.actualQty = item.actualQty || 0;
                item.scheduledQty = item.scheduledQty || 0;
                item.category = item.category || 'ê¸°íƒ€';
                item.vendor = item.vendor || 'ë¯¸ë¶„ë¥˜';
                item.season = item.season || currentSeason;
                
                return item;
            }).filter(item => item && item.deliveryWeek && item.deliveryYear); // ìœ íš¨í•œ ë‚©ê¸° ì£¼ì°¨ ë°ì´í„°ë§Œ
            
            // ë‚©ê¸°ì£¼ì°¨ ì»¬ëŸ¼ ë°ì´í„° ë¶„ì„
            const deliveryWeekData = rows.map((row, index) => {
                const deliveryWeekIndex = mappedHeaders.deliveryWeek;
                if (deliveryWeekIndex !== -1 && row[deliveryWeekIndex] !== undefined) {
                    const convertedWeek = convertToWeekNumber(row[deliveryWeekIndex]);
                    return {
                        rowIndex: index,
                        originalValue: row[deliveryWeekIndex],
                        convertedValue: convertedWeek,
                        isValid: convertedWeek > 0 && convertedWeek <= 53
                    };
                }
                return null;
            }).filter(Boolean);

            if (uploadedData.length === 0) {
                // ìƒì„¸í•œ ì˜¤ë¥˜ ë©”ì‹œì§€ ìƒì„± (ì‹œì¦Œë³„ ì£¼ì°¨ ë²”ìœ„ ì ìš©)
                let errorMessage = `${currentSeason} ì‹œì¦Œ ë°ì´í„° ì²˜ë¦¬ ì‹¤íŒ¨: ìœ íš¨í•œ ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\n\n`;
                errorMessage += `ê°€ëŠ¥í•œ ì›ì¸:\n`;
                errorMessage += `1. ë‚©ê¸°ì£¼ì°¨ ì»¬ëŸ¼ì´ ì—†ê±°ë‚˜ ì˜ëª»ëœ í˜•ì‹\n`;
                errorMessage += `2. ì—‘ì…€ í•¨ìˆ˜ ê²°ê³¼ê°€ ë¹„ì •ìƒì ì¸ ê°’ (ì˜ˆ: 45766ì£¼ì°¨ ë“±)\n`;
                errorMessage += `3. ì£¼ì°¨ ë²ˆí˜¸ê°€ ì‹œì¦Œë³„ ë²”ìœ„ë¥¼ ë²—ì–´ë‚¨\n`;
                errorMessage += `4. í—¤ë” ë§¤í•‘ ì‹¤íŒ¨ (${currentSeason} ì‹œì¦Œ í—¤ë”ëª… ë¶ˆì¼ì¹˜)\n\n`;
                errorMessage += `í•´ê²° ë°©ë²•:\n`;
                errorMessage += `- ì—‘ì…€ íŒŒì¼ì˜ ë‚©ê¸°ì£¼ì°¨ ì»¬ëŸ¼ëª…ì„ í™•ì¸í•˜ì„¸ìš” (ì£¼ì°¨, Week, ë‚©ê¸°ì£¼ì°¨ ë“±)\n`;
                errorMessage += `- ì—‘ì…€ í•¨ìˆ˜ë‚˜ ìˆ˜ì‹ì„ ì œê±°í•˜ê³  ì§ì ‘ ìˆ«ìë¥¼ ì…ë ¥í•˜ì„¸ìš”\n`;
                errorMessage += `- íŒŒì¼ëª…ì— "${currentSeason}"ê°€ í¬í•¨ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”\n`;
                errorMessage += `- ë‚©ê¸°ì£¼ì°¨ ì»¬ëŸ¼ì— ë‚ ì§œê°€ ì•„ë‹Œ ì£¼ì°¨ ë²ˆí˜¸ê°€ ì…ë ¥ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”\n\n`;
                errorMessage += `ì‹œì¦Œë³„ ì˜¬ë°”ë¥¸ ì£¼ì°¨ ë²”ìœ„:\n`;
                if (currentSeason === '25FW') {
                    errorMessage += `- 25FW ì‹œì¦Œ: 2025ë…„ 1ì£¼ì°¨~2025ë…„ 53ì£¼ì°¨\n`;
                } else if (currentSeason === '26SS') {
                    errorMessage += `- 26SS ì‹œì¦Œ: 2025ë…„ 40ì£¼ì°¨~2026ë…„ 39ì£¼ì°¨\n`;
                } else {
                    errorMessage += `- 2025ë…„: 1ì£¼ì°¨, 2ì£¼ì°¨, 3ì£¼ì°¨, ..., 53ì£¼ì°¨\n`;
                    errorMessage += `- 2026ë…„: 1ì£¼ì°¨, 2ì£¼ì°¨, 3ì£¼ì°¨, ..., 53ì£¼ì°¨\n`;
                }
                errorMessage += `- ì§ì ‘ ì…ë ¥: 1, 2, 3, ..., 53\n\n`;
                errorMessage += `ë””ë²„ê¹… ì •ë³´:\n`;
                errorMessage += `- ì›ë³¸ ë°ì´í„° í–‰ ìˆ˜: ${rows.length}\n`;
                errorMessage += `- ì²˜ë¦¬ëœ ì£¼ì°¨ ê°œìˆ˜ (${currentSeason} ì‹œì¦Œ): ${deliveryWeekData.filter(item => item.isValid).length}\n`;
                errorMessage += `- ì¡°ì •ëœ ì£¼ì°¨ ê°œìˆ˜: ${deliveryWeekData.filter(item => !item.isValid).length}\n`;
                if (deliveryWeekData.filter(item => !item.isValid).length > 0) {
                    errorMessage += `- ì¡°ì •ëœ ì£¼ì°¨ ì˜ˆì‹œ: ${deliveryWeekData.filter(item => !item.isValid).slice(0, 3).map(item => `${item.originalValue}(${item.convertedValue})`).join(', ')}\n`;
                }
                
                throw new Error(errorMessage);
            }

            // ìµœì‹  ë‚©ê¸° ì£¼ì°¨ ì„¤ì •
            const latestDeliveryWeek = Math.max(...uploadedData.map(item => item.deliveryWeek));
            const latestDeliveryYear = Math.max(...uploadedData.map(item => item.deliveryYear));
            currentWeek = latestDeliveryWeek;
            currentYear = latestDeliveryYear;

            // ê°€ì¥ ì´ë¥¸ ì£¼ì°¨ ì°¾ê¸° (ì‹œì‘ ì£¼ì°¨ ì„¤ì •)
            // ë…„ë„+ì£¼ì°¨ ì¡°í•©ìœ¼ë¡œ ê°€ì¥ ì´ë¥¸ ê²ƒì„ ì°¾ê¸°
            const weekCombinations = uploadedData.map(item => ({
                year: item.deliveryYear,
                week: item.deliveryWeek,
                key: `${item.deliveryYear}-${String(item.deliveryWeek).padStart(2, '0')}`
            }));
            
            // ë…„ë„ì™€ ì£¼ì°¨ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì •ë ¬í•˜ì—¬ ê°€ì¥ ì´ë¥¸ ê²ƒ ì°¾ê¸°
            weekCombinations.sort((a, b) => {
                if (a.year !== b.year) return a.year - b.year;
                return a.week - b.week;
            });
            
            const earliest = weekCombinations[0];
            startYear = earliest.year;
            startWeek = earliest.week;

            // UI ì—…ë°ì´íŠ¸
            updateUI();
            applyFilters();
        }

        // í—¤ë” ë§¤í•‘ (ì‹œì¦Œë³„ ë§¤ì¹­ ë¡œì§)
        function mapHeaders(headers, headerMapping) {
            const mapped = {};
            Object.keys(headerMapping).forEach(key => {
                mapped[key] = -1;
                for (let i = 0; i < headers.length; i++) {
                    const header = String(headers[i]).trim();
                    
                    // 1. ì •í™•í•œ ë§¤ì¹­ ì‹œë„
                    if (headerMapping[key].some(pattern => 
                        header.toLowerCase() === pattern.toLowerCase()
                    )) {
                        mapped[key] = i;
                        break;
                    }
                    
                    // 2. ë¶€ë¶„ ë§¤ì¹­ ì‹œë„ (ë” ìœ ì—°í•œ ë§¤ì¹­)
                    if (headerMapping[key].some(pattern => 
                        header.toLowerCase().includes(pattern.toLowerCase()) ||
                        pattern.toLowerCase().includes(header.toLowerCase())
                    )) {
                        mapped[key] = i;
                        break;
                    }
                    
                    // 3. í‚¤ì›Œë“œ ê¸°ë°˜ ë§¤ì¹­ (ì‹œì¦Œ íŠ¹í™”)
                    if (key === 'deliveryWeek' && (
                        header.includes('ì£¼ì°¨') || header.includes('Week') || header.includes('week') ||
                        header.includes('ë‚©ê¸°') || header.includes('ISO') || header.includes('iso') ||
                        header.includes('WEEK') || header.includes('Wk') || header.includes('wk')
                    )) {
                        mapped[key] = i;
                        break;
                    }
                    
                    if (key === 'targetQty' && (
                        header.includes('ë°œì£¼') || header.includes('ëª©í‘œ') || header.includes('Target') ||
                        header.includes('ìˆ˜ëŸ‰') || header.includes('Qty') || header.includes('qty') ||
                        header.includes('TARGET') || header.includes('ë°œì£¼ëŸ‰') || header.includes('ëª©í‘œëŸ‰')
                    )) {
                        mapped[key] = i;
                        break;
                    }
                    
                    if (key === 'actualQty' && (
                        header.includes('ì…ê³ ') || header.includes('ì‹¤ì œ') || header.includes('Actual') ||
                        header.includes('ì••ê³ ') || header.includes('ì‹¤ì…ê³ ') || header.includes('ACTUAL') ||
                        header.includes('ì…ê³ ëŸ‰') || header.includes('ì‹¤ì œëŸ‰')
                    )) {
                        mapped[key] = i;
                        break;
                    }
                    
                    if (key === 'category' && (
                        header.includes('ì œí’ˆ') || header.includes('êµ¬ë¶„') || header.includes('Category') ||
                        header.includes('ë¶„ë¥˜') || header.includes('Type')
                    )) {
                        mapped[key] = i;
                        break;
                    }
                    
                    if (key === 'country' && (
                        header.includes('êµ­ê°€') || header.includes('Country') || header.includes('íŒë§¤') ||
                        header.includes('Market') || header.includes('Region')
                    )) {
                        mapped[key] = i;
                        break;
                    }
                    
                    if (key === 'vendor' && (
                        header.includes('í˜‘ë ¥') || header.includes('Vendor') || header.includes('ì—…ì²´') ||
                        header.includes('ê³µê¸‰') || header.includes('Supplier')
                    )) {
                        mapped[key] = i;
                        break;
                    }
                    
                    if (key === 'season' && (
                        header.includes('ì‹œì¦Œ') || header.includes('Season') || header.includes('FW') ||
                        header.includes('SS') || header.includes('Fall') || header.includes('Winter')
                    )) {
                        mapped[key] = i;
                        break;
                    }
                }
            });
            return mapped;
        }

        // ì£¼ì°¨ ë²ˆí˜¸ ë³€í™˜ í•¨ìˆ˜ (ì…ë ¥ëœ ìˆ«ì ê¸°ì¤€ìœ¼ë¡œ ì£¼ì°¨ ì„¤ì •) - 45766ì£¼ì°¨ ê°™ì€ ì˜¤ë¥˜ ìˆ˜ì •
        function convertToWeekNumber(value) {
            if (!value) return 0;
            
            // ìˆ«ìì¸ ê²½ìš°
            if (typeof value === 'number') {
                // ì´ë¯¸ ìœ íš¨í•œ ì£¼ì°¨ ë²ˆí˜¸ì¸ ê²½ìš°
                if (value > 0 && value <= 53) {
                    return value;
                }
                // ë¹„ì •ìƒì ìœ¼ë¡œ í° ê°’ì¸ ê²½ìš° (Excel ë‚ ì§œ ì‹œë¦¬ì–¼ ë²ˆí˜¸ì¼ ê°€ëŠ¥ì„±)
                if (value > 1000) {
                    // Excel ë‚ ì§œ ì‹œë¦¬ì–¼ ë²ˆí˜¸ë¥¼ ì‹¤ì œ ë‚ ì§œë¡œ ë³€í™˜ ì‹œë„
                    try {
                        const excelDate = new Date((value - 25569) * 86400 * 1000);
                        if (!isNaN(excelDate.getTime())) {
                            const week = getWeekNumber(excelDate);
                            // ë³€í™˜ëœ ì£¼ì°¨ê°€ ìœ íš¨í•œ ë²”ìœ„ì¸ì§€ í™•ì¸
                            if (week > 0 && week <= 53) {
                                return week;
                            } else {
                                // ë³€í™˜ ì‹¤íŒ¨ ì‹œ ì›ë³¸ ê°’ì„ 1-53 ë²”ìœ„ë¡œ ì¡°ì •
                                const adjustedWeek = ((value - 1) % 53) + 1;
                                return adjustedWeek;
                            }
                        }
                    } catch (e) {
                        // ë³€í™˜ ì‹¤íŒ¨ ì²˜ë¦¬
                    }
                    
                    // ë³€í™˜ ì‹¤íŒ¨ ì‹œ ì›ë³¸ ê°’ì„ 1-53 ë²”ìœ„ë¡œ ì¡°ì •
                    const adjustedWeek = ((value - 1) % 53) + 1;
                    return adjustedWeek;
                }
                return value;
            }
            
            // ë¬¸ìì—´ì¸ ê²½ìš°
            if (typeof value === 'string') {
                const cleaned = value.replace(/,/g, '').trim();
                
                // "2025-45766ì£¼ì°¨" ê°™ì€ ë¹„ì •ìƒì ì¸ í˜•ì‹ ì²´í¬
                const invalidPattern = /^\d{4}-\d{5,}ì£¼ì°¨$/;
                if (invalidPattern.test(cleaned)) {
                    return 0;
                }
                
                // ìˆ«ìë¡œ ë³€í™˜ ì‹œë„
                const parsed = parseFloat(cleaned);
                if (!isNaN(parsed)) {
                    // ìœ íš¨í•œ ì£¼ì°¨ ë²ˆí˜¸ì¸ ê²½ìš°
                    if (parsed > 0 && parsed <= 53) {
                        return parsed;
                    }
                    // ë¹„ì •ìƒì ìœ¼ë¡œ í° ê°’ì¸ ê²½ìš° (Excel ë‚ ì§œ ì‹œë¦¬ì–¼ ë²ˆí˜¸)
                    if (parsed > 1000) {
                        try {
                            const excelDate = new Date((parsed - 25569) * 86400 * 1000);
                            if (!isNaN(excelDate.getTime())) {
                                const week = getWeekNumber(excelDate);
                                // ë³€í™˜ëœ ì£¼ì°¨ê°€ ìœ íš¨í•œ ë²”ìœ„ì¸ì§€ í™•ì¸
                                if (week > 0 && week <= 53) {
                                    return week;
                                } else {
                                    // ë³€í™˜ ì‹¤íŒ¨ ì‹œ ì›ë³¸ ê°’ì„ 1-53 ë²”ìœ„ë¡œ ì¡°ì •
                                    const adjustedWeek = ((parsed - 1) % 53) + 1;
                                    return adjustedWeek;
                                }
                            }
                        } catch (e) {
                            // ë³€í™˜ ì‹¤íŒ¨ ì²˜ë¦¬
                        }
                        // ë³€í™˜ ì‹¤íŒ¨ ì‹œ ì›ë³¸ ê°’ì„ 1-53 ë²”ìœ„ë¡œ ì¡°ì •
                        const adjustedWeek = ((parsed - 1) % 53) + 1;
                        return adjustedWeek;
                    }
                    return parsed;
                }
                
                // ë‚ ì§œ í˜•ì‹ì¸ ê²½ìš° ë³€í™˜ ì‹œë„
                const date = new Date(cleaned);
                if (!isNaN(date.getTime())) {
                    const week = getWeekNumber(date);
                    if (week > 0 && week <= 53) {
                        return week;
                    } else {
                        // ë³€í™˜ ì‹¤íŒ¨ ì‹œ ì›ë³¸ ê°’ì„ 1-53 ë²”ìœ„ë¡œ ì¡°ì •
                        const adjustedWeek = ((week - 1) % 53) + 1;
                        return adjustedWeek;
                    }
                }

                // "2025ë…„ 44ì£¼ì°¨" í˜•ì‹ì¸ ê²½ìš°
                const weekMatch = cleaned.match(/(\d{1,2})ì£¼ì°¨/);
                if (weekMatch) {
                    const week = parseInt(weekMatch[1]);
                    if (week > 0 && week <= 53) {
                        return week;
                    } else {
                        // ë³€í™˜ ì‹¤íŒ¨ ì‹œ ì›ë³¸ ê°’ì„ 1-53 ë²”ìœ„ë¡œ ì¡°ì •
                        const adjustedWeek = ((week - 1) % 53) + 1;
                        return adjustedWeek;
                    }
                }

                // "44" í˜•ì‹ì¸ ê²½ìš°
                const simpleMatch = cleaned.match(/^(\d{1,2})$/);
                if (simpleMatch) {
                    const week = parseInt(simpleMatch[1]);
                    if (week > 0 && week <= 53) {
                        return week;
                    } else {
                        // ë³€í™˜ ì‹¤íŒ¨ ì‹œ ì›ë³¸ ê°’ì„ 1-53 ë²”ìœ„ë¡œ ì¡°ì •
                        const adjustedWeek = ((week - 1) % 53) + 1;
                        return adjustedWeek;
                    }
                }

                // "W44" ë˜ëŠ” "WEEK44" í˜•ì‹ì¸ ê²½ìš°
                const wMatch = cleaned.match(/W(?:EEK)?(\d{1,2})/i);
                if (wMatch) {
                    const week = parseInt(wMatch[1]);
                    if (week > 0 && week <= 53) {
                        return week;
                    } else {
                        // ë³€í™˜ ì‹¤íŒ¨ ì‹œ ì›ë³¸ ê°’ì„ 1-53 ë²”ìœ„ë¡œ ì¡°ì •
                        const adjustedWeek = ((week - 1) % 53) + 1;
                        return adjustedWeek;
                    }
                }
            }
            
            // ëª¨ë“  ë³€í™˜ ì‹œë„ê°€ ì‹¤íŒ¨í•œ ê²½ìš°
            return 0;
        }

        // ë‚ ì§œ íŒŒì‹± í•¨ìˆ˜ (25FW ì˜¤ë¥˜ ìˆ˜ì •)
        function parseDate(value) {
            if (!value) return null;
            
            // ì´ë¯¸ Date ê°ì²´ì¸ ê²½ìš°
            if (value instanceof Date) {
                return value;
            }
            
            // ìˆ«ìì¸ ê²½ìš° (Excel ë‚ ì§œ ì‹œë¦¬ì–¼ ë²ˆí˜¸)
            if (typeof value === 'number') {
                if (value > 1000) {
                    try {
                        const excelDate = new Date((value - 25569) * 86400 * 1000);
                        if (!isNaN(excelDate.getTime())) {
                            return excelDate;
                        }
                    } catch (e) {
                        // ë³€í™˜ ì‹¤íŒ¨ ì²˜ë¦¬
                    }
                }
                return null;
            }
            
            // ë¬¸ìì—´ì¸ ê²½ìš°
            if (typeof value === 'string') {
                const cleaned = value.trim();
                
                // ë‹¤ì–‘í•œ ë‚ ì§œ í˜•ì‹ ì‹œë„
                const formats = [
                    cleaned, // ì›ë³¸
                    cleaned.replace(/[^\d]/g, '/'), // êµ¬ë¶„ì ì •ê·œí™”
                    cleaned.replace(/[^\d]/g, '-'), // í•˜ì´í”ˆìœ¼ë¡œ ë³€ê²½
                    cleaned.replace(/[^\d]/g, '.'), // ì ìœ¼ë¡œ ë³€ê²½
                ];
                
                for (const format of formats) {
                    const date = new Date(format);
                    if (!isNaN(date.getTime())) {
                        return date;
                    }
                }
            }
            
            return null;
        }

        // ìˆ«ì íŒŒì‹± (ì½¤ë§ˆ ì œê±° + ë¹„ì •ìƒì ì¸ ê°’ ì²˜ë¦¬)
        function parseNumber(value) {
            if (typeof value === 'number') {
                // ë¹„ì •ìƒì ìœ¼ë¡œ í° ê°’ ì²´í¬
                if (value > 1000000) {
                    return 0;
                }
                return value;
            }
            if (typeof value === 'string') {
                const cleaned = value.replace(/,/g, '').trim();
                const parsed = parseFloat(cleaned);
                
                // ë¹„ì •ìƒì ìœ¼ë¡œ í° ê°’ ì²´í¬
                if (parsed > 1000000) {
                    return 0;
                }
                
                return parsed || 0;
            }
            return 0;
        }

        // ISO Week ê³„ì‚° (ì›”ìš”ì¼ ì‹œì‘ ê¸°ì¤€) - ì •í™•í•œ ê³„ì‚°
        function getWeekNumber(date) {
            // ISO Week í‘œì¤€ ê³„ì‚° (ì›”ìš”ì¼ ì‹œì‘ ê¸°ì¤€)
            const target = new Date(date.valueOf());
            const dayNr = (date.getDay() + 6) % 7; // ì›”ìš”ì¼ì„ 0ìœ¼ë¡œ ë§Œë“¤ê¸°
            target.setDate(target.getDate() - dayNr + 3); // ëª©ìš”ì¼ë¡œ ì´ë™
            const firstThursday = target.valueOf();
            target.setMonth(0, 1);
            if (target.getDay() !== 4) {
                target.setMonth(0, 1 + ((4 - target.getDay()) + 7) % 7);
            }
            return 1 + Math.ceil((firstThursday - target) / 604800000);
        }

        // ì‹œì¦Œë³„ ì£¼ì°¨ ë²”ìœ„ ê²€ì¦ í•¨ìˆ˜
        function isValidWeekForSeason(week, year) {
            // 25FW ì‹œì¦Œ: 2025ë…„ 1ì£¼ì°¨~2025ë…„ 53ì£¼ì°¨
            if (currentSeason === '25FW') {
                return year === 2025 && week >= 1 && week <= 53;
            }
            
            // 26SS ì‹œì¦Œ: 2025ë…„ 40ì£¼ì°¨~2026ë…„ 39ì£¼ì°¨
            if (currentSeason === '26SS') {
                return (year === 2025 && week >= 40 && week <= 53) || 
                       (year === 2026 && week >= 1 && week <= 39);
            }
            
            // ê¸°ë³¸ê°’: ëª¨ë“  ì£¼ì°¨ í—ˆìš©
            return year === 2025 || year === 2026;
        }

        // ì£¼ì°¨ë³„ ì—°ë„ ê·œì¹™ í•¨ìˆ˜ (ì‹œì¦Œë³„ ì£¼ì°¨ ë²”ìœ„ ì ìš©)
        function getYearFromDeliveryWeek(week) {
            // ì‹œì¦Œë³„ ì£¼ì°¨ ë²”ìœ„ì— ë”°ë¥¸ ì—°ë„ ê²°ì •
            if (week >= 1 && week <= 53) {
                // 25FW ì‹œì¦Œ: 2025ë…„ 1ì£¼ì°¨~2025ë…„ 53ì£¼ì°¨
                if (currentSeason === '25FW') {
                    if (week >= 1 && week <= 53) {
                        return 2025;
                    }
                }
                
                // 26SS ì‹œì¦Œ: 2025ë…„ 40ì£¼ì°¨~2026ë…„ 39ì£¼ì°¨
                if (currentSeason === '26SS') {
                    if (week >= 40 && week <= 53) {
                        return 2025; // 2025ë…„ 40~53ì£¼ì°¨
                    } else if (week >= 1 && week <= 39) {
                        return 2026; // 2026ë…„ 1~39ì£¼ì°¨
                    }
                }
                
                // ê¸°ë³¸ê°’ (ì‹œì¦Œì´ ê°ì§€ë˜ì§€ ì•Šì€ ê²½ìš°)
                const currentDate = new Date();
                const currentYear = currentDate.getFullYear();
                
                if (currentYear === 2025) {
                    return 2025;
                } else if (currentYear === 2026) {
                    return 2026;
                } else if (currentYear < 2025) {
                    return 2025;
                } else {
                    return 2026;
                }
            }
            
            // ìœ íš¨í•˜ì§€ ì•Šì€ ì£¼ì°¨ ë²ˆí˜¸ëŠ” null ë°˜í™˜ (ì œê±° ëŒ€ìƒ)
            return null;
        }

        // ì£¼ì°¨ì—ì„œ ë‚ ì§œ ê³„ì‚° (ISO Week ê¸°ì¤€)
        function getDateFromWeekNumber(year, weekNumber) {
            // ISO Week ê¸°ì¤€ìœ¼ë¡œ ì£¼ì°¨ì˜ ì²« ë²ˆì§¸ ë‚ (ì›”ìš”ì¼) ê³„ì‚°
            const jan4 = new Date(year, 0, 4); // 1ì›” 4ì¼ì€ í•­ìƒ ì²« ë²ˆì§¸ ì£¼ì— í¬í•¨
            const jan4Week = getWeekNumber(jan4);
            const daysToAdd = (weekNumber - jan4Week) * 7;
            const weekStart = new Date(jan4);
            weekStart.setDate(jan4.getDate() + daysToAdd);
            
            // ì›”ìš”ì¼ë¡œ ì¡°ì •
            const dayOfWeek = (weekStart.getDay() + 6) % 7; // ì›”ìš”ì¼ì„ 0ìœ¼ë¡œ ë§Œë“¤ê¸°
            weekStart.setDate(weekStart.getDate() - dayOfWeek);
            
            return weekStart;
        }

        // íŒë§¤êµ­ê°€ ë§¤í•‘ í•¨ìˆ˜
        function mapCountry(country) {
            if (!country) return 'GL_ì§ì†¡';
            
            const countryStr = String(country).toUpperCase().trim();
            
            // KR, CN, GL ë§¤í•‘ í™•ì¸
            for (const [mappedCountry, patterns] of Object.entries(countryMapping)) {
                if (mappedCountry === 'GL_ì§ì†¡') continue;
                if (patterns.some(pattern => countryStr.includes(pattern.toUpperCase()))) {
                    return mappedCountry;
                }
            }
            
            // ë§¤í•‘ë˜ì§€ ì•Šì€ êµ­ê°€ëŠ” GL_ì§ì†¡ìœ¼ë¡œ ë¶„ë¥˜
            return 'GL_ì§ì†¡';
        }

        // UI ì—…ë°ì´íŠ¸
        function updateUI() {
            // ì„¹ì…˜ í‘œì‹œ
            document.getElementById('filterSection').style.display = 'block';
            document.getElementById('weekSelector').style.display = 'block';
            document.getElementById('kpiSection').style.display = 'grid';
            document.getElementById('performancePanels').style.display = 'grid';
            document.getElementById('chartSection').style.display = 'grid';
            document.getElementById('tableSection').style.display = 'block';

            // í•„í„° ì˜µì…˜ ì—…ë°ì´íŠ¸
            updateFilterOptions();
            
            // ì£¼ì°¨ ì„ íƒ ì˜µì…˜ ì—…ë°ì´íŠ¸
            updateWeekOptions();
            
            // í—¤ë” ì •ë³´ ì—…ë°ì´íŠ¸
            updateHeaderInfo();
            
            // ì„±ê³¼ íŒ¨ë„ ì—…ë°ì´íŠ¸
            updatePerformancePanels();
        }

        // ì„±ê³¼ íŒ¨ë„ ì—…ë°ì´íŠ¸
        function updatePerformancePanels() {
            updateProductPerformance();
            updateCountryStatus();
            updateWeeklyPlan();
        }

        // ì œí’ˆ êµ¬ë¶„ë³„ ì„±ê³¼ ì—…ë°ì´íŠ¸
        function updateProductPerformance() {
            const productData = {};
            const categories = ['KNIT', 'SWEATER', 'WOVEN', 'DENIM'];
            
            // ê° ì œí’ˆ ì¹´í…Œê³ ë¦¬ë³„ ë°ì´í„° ì§‘ê³„
            categories.forEach(category => {
                productData[category] = { target: 0, actual: 0 };
            });

            filteredData.forEach(item => {
                const category = item.category || 'ê¸°íƒ€';
                if (categories.includes(category)) {
                    productData[category].target += item.targetQty || 0;
                    productData[category].actual += item.actualQty || 0;
                }
            });

            const container = document.getElementById('productPerformance');
            container.innerHTML = '';

            categories.forEach(category => {
                const data = productData[category];
                const targetInt = Math.round(data.target);
                const actualInt = Math.round(data.actual);
                const achievementRate = targetInt > 0 ? ((actualInt / targetInt) * 100).toFixed(2) : '0.00';
                
                const item = document.createElement('div');
                item.className = 'performance-item';
                item.innerHTML = `
                    <span class="item-label">${category}</span>
                    <span class="item-value"><span class="target-section">ëª©í‘œ: ${targetInt.toLocaleString()}ì¥</span>/ì‹¤ì œ: ${actualInt.toLocaleString()}ì¥ (${achievementRate}%)</span>
                `;
                container.appendChild(item);
            });
        }

        // íŒë§¤êµ­ê°€ë³„ í˜„í™© ì—…ë°ì´íŠ¸
        function updateCountryStatus() {
            const countryData = {};
            const countries = ['KR', 'CN', 'GL', 'GL_ì§ì†¡'];
            
            // ê° êµ­ê°€ë³„ ë°ì´í„° ì§‘ê³„
            countries.forEach(country => {
                countryData[country] = { target: 0, actual: 0, hasData: false };
            });

            filteredData.forEach(item => {
                const mappedCountry = item.mappedCountry || 'GL_ì§ì†¡';
                if (countryData[mappedCountry]) {
                    countryData[mappedCountry].target += item.targetQty || 0;
                    countryData[mappedCountry].actual += item.actualQty || 0;
                    countryData[mappedCountry].hasData = true;
                }
            });

            const container = document.getElementById('countryStatus');
            container.innerHTML = '';

            countries.forEach(country => {
                const data = countryData[country];
                const countryNames = {
                    'KR': 'KR (í•œêµ­)',
                    'CN': 'CN (ì¤‘êµ­)',
                    'GL': 'GL (ê¸€ë¡œë²Œ)',
                    'GL_ì§ì†¡': 'GL_ì§ì†¡ (ê¸°íƒ€)'
                };
                
                const item = document.createElement('div');
                item.className = 'performance-item';
                
                if (data.hasData) {
                    const targetInt = Math.round(data.target);
                    const actualInt = Math.round(data.actual);
                    const achievementRate = targetInt > 0 ? ((actualInt / targetInt) * 100).toFixed(2) : '0.00';
                    item.innerHTML = `
                        <span class="item-label">${countryNames[country]}</span>
                        <span class="item-value"><span class="target-section">ëª©í‘œ: ${targetInt.toLocaleString()}ì¥</span>/ì‹¤ì œ: ${actualInt.toLocaleString()}ì¥ (${achievementRate}%)</span>
                    `;
                } else {
                    item.innerHTML = `
                        <span class="item-label">${countryNames[country]}</span>
                        <span class="item-value no-data">ë°ì´í„° ì—†ìŒ</span>
                    `;
                }
                
                container.appendChild(item);
            });
        }

        // ì´ë²ˆ ì£¼ ëª©í‘œ ë‹¬ì„± ê³„íš ì—…ë°ì´íŠ¸
        function updateWeeklyPlan() {
            if (!currentWeek || !currentYear) return;

            // í˜„ì¬ ë‚©ê¸° ì£¼ì°¨ ë°ì´í„°ë§Œ í•„í„°ë§
            const currentWeekData = filteredData.filter(item => 
                item.deliveryYear === currentYear && item.deliveryWeek === currentWeek
            );

            const totalTarget = currentWeekData.reduce((sum, item) => sum + (item.targetQty || 0), 0);
            const totalActual = currentWeekData.reduce((sum, item) => sum + (item.actualQty || 0), 0);
            const remainingTarget = Math.round(Math.max(0, totalTarget - totalActual));

            // ì¼ì¼ í•„ìš”ëŸ‰ ê³„ì‚° (ì£¼ë§ ì œì™¸, ì›”-ê¸ˆ 5ì¼ ê¸°ì¤€)
            const dailyRequired = remainingTarget > 0 ? Math.round(Math.ceil(remainingTarget / 5)) : 0;

            // ì˜ˆìƒ ì™„ë£Œì¼ ê³„ì‚° (í˜„ì¬ ë‚ ì§œ ê¸°ì¤€)
            const today = new Date();
            const daysToComplete = remainingTarget > 0 ? Math.ceil(remainingTarget / dailyRequired) : 0;
            const estimatedDate = new Date(today);
            estimatedDate.setDate(today.getDate() + daysToComplete);

            // ìœ„í—˜ë„ ê³„ì‚°
            const achievementRate = totalTarget > 0 ? (totalActual / totalTarget) * 100 : 0;
            const riskLevel = achievementRate < 50 ? 'ë†’ìŒ' : achievementRate < 80 ? 'ë³´í†µ' : 'ë‚®ìŒ';

            const container = document.getElementById('weeklyPlan');
            container.innerHTML = `
                <div class="performance-item">
                    <span class="item-label">ë‚¨ì€ ëª©í‘œëŸ‰ (Remaining Target Quantity)</span>
                    <span class="item-value">${remainingTarget.toLocaleString()}ì¥</span>
                </div>
                <div class="performance-item">
                    <span class="item-label">ì¼ì¼ í•„ìš”ëŸ‰ (Daily Required Quantity)</span>
                    <span class="item-value">${dailyRequired.toLocaleString()}ì¥/ì¼</span>
                </div>
                <div class="performance-item">
                    <span class="item-label">ì˜ˆìƒ ì™„ë£Œì¼ (Estimated Completion Date)</span>
                    <span class="item-value">${estimatedDate.toLocaleDateString('ko-KR').replace(/\./g, '.').replace(/\s/g, '')}</span>
                </div>
                <div class="performance-item">
                    <span class="item-label">ìœ„í—˜ë„ (Risk Level)</span>
                    <span class="item-value ${riskLevel === 'ë†’ìŒ' ? 'high-risk' : ''}">${riskLevel}</span>
                </div>
            `;
        }

        // í•„í„° ì˜µì…˜ ì—…ë°ì´íŠ¸
        function updateFilterOptions() {
            const categories = [...new Set(uploadedData.map(item => item.category).filter(Boolean))];
            const countries = [...new Set(uploadedData.map(item => item.mappedCountry).filter(Boolean))];
            const vendors = [...new Set(uploadedData.map(item => item.vendor).filter(Boolean))];
            const seasons = [...new Set(uploadedData.map(item => item.season).filter(Boolean))];

            updateSelectOptions('productFilter', categories);
            updateSelectOptions('countryFilter', countries);
            updateSelectOptions('vendorFilter', vendors);
            updateSelectOptions('seasonFilter', seasons);
        }

        // ì£¼ì°¨ ì„ íƒ ì˜µì…˜ ì—…ë°ì´íŠ¸ (ì‹œì¦Œë³„ ì£¼ì°¨ ë²”ìœ„ ì ìš©)
        function updateWeekOptions() {
            // ì—…ë¡œë“œí•œ ë°ì´í„°ì—ì„œ ì‹œì¦Œë³„ ìœ íš¨í•œ ë‚©ê¸°ì£¼ì°¨ ì •ë³´ë§Œ ì¶”ì¶œ
            const weeks = [...new Set(uploadedData.map(item => {
                // ì‹œì¦Œë³„ ì£¼ì°¨ ë²”ìœ„ ê²€ì¦
                if (item.deliveryWeek && item.deliveryYear && 
                    isValidWeekForSeason(item.deliveryWeek, item.deliveryYear)) {
                    return `${item.deliveryYear}-${item.deliveryWeek}`;
                }
                return null;
            }).filter(Boolean))].sort();
            
            const select = document.getElementById('weekSelect');
            select.innerHTML = '<option value="">ì£¼ì°¨ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>';
            
            // ì „ì²´ì£¼ì°¨ ì˜µì…˜ ì¶”ê°€
            const allOption = document.createElement('option');
            allOption.value = 'all';
            allOption.textContent = 'ì „ì²´ì£¼ì°¨';
            select.appendChild(allOption);
            
            // ìœ íš¨í•˜ì§€ ì•Šì€ ì£¼ì°¨ ë°ì´í„° ë¡œê·¸ (2025-2026ë…„ ISO Week ê¸°ì¤€)
            const invalidWeeks = uploadedData.filter(item => 
                item.deliveryWeek && (item.deliveryWeek < 1 || item.deliveryWeek > 53 ||
                (item.deliveryYear !== 2025 && item.deliveryYear !== 2026))
            );
            
            weeks.forEach(week => {
                const option = document.createElement('option');
                option.value = week;
                option.textContent = `${week.split('-')[0]}ë…„ ${week.split('-')[1]}ì£¼ì°¨`;
                select.appendChild(option);
            });

            // í˜„ì¬ ì£¼ì°¨ ì„ íƒ (ìµœì‹  ì£¼ì°¨ë¡œ ìë™ ì„¤ì •)
            if (currentWeek && currentYear && currentWeek >= 1 && currentWeek <= 53 &&
                (currentYear === 2025 || currentYear === 2026)) {
                select.value = `${currentYear}-${currentWeek}`;
            }
        }

        // í—¤ë” ì •ë³´ ì—…ë°ì´íŠ¸ (2025-2026ë…„ ISO Week ê¸°ì¤€)
        function updateHeaderInfo() {
            if (currentWeek && currentYear && (currentYear === 2025 || currentYear === 2026)) {
                document.getElementById('currentWeekDisplay').textContent = `${currentYear}ë…„ ${currentWeek}ì£¼ì°¨`;
                
                // ISO Week ê¸°ì¤€ ì£¼ì°¨ ë‚ ì§œ ë²”ìœ„ ê³„ì‚°
                const startDate = getDateFromWeekNumber(currentYear, currentWeek);
                const endDate = new Date(startDate);
                endDate.setDate(endDate.getDate() + 6); // ì¼ìš”ì¼ê¹Œì§€
                
                document.getElementById('dateRangeDisplay').textContent = 
                    `${startDate.toLocaleDateString()} ~ ${endDate.toLocaleDateString()}`;
            } else {
                document.getElementById('currentWeekDisplay').textContent = 'ìœ íš¨í•œ ì£¼ì°¨ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤';
                document.getElementById('dateRangeDisplay').textContent = '';
            }
        }


        // í•„í„° ì ìš©
        function applyFilters() {
            const productFilter = document.getElementById('productFilter').value;
            const countryFilter = document.getElementById('countryFilter').value;
            const vendorFilter = document.getElementById('vendorFilter').value;
            const seasonFilter = document.getElementById('seasonFilter').value;
            const statusFilter = document.getElementById('statusFilter').value;

            filteredData = uploadedData.filter(item => {
                if (productFilter && item.category !== productFilter) return false;
                if (countryFilter && item.mappedCountry !== countryFilter) return false;
                if (vendorFilter && item.vendor !== vendorFilter) return false;
                if (seasonFilter && item.season !== seasonFilter) return false;
                
                // ë‚©ê¸° ì£¼ì°¨ í•„í„° ì ìš© (í˜„ì¬ ì„ íƒëœ ì£¼ì°¨ê¹Œì§€ì˜ ë°ì´í„°ë§Œ í‘œì‹œ)
                if (currentWeek && currentYear) {
                    if (item.deliveryYear > currentYear) return false;
                    if (item.deliveryYear === currentYear && item.deliveryWeek > currentWeek) return false;
                }
                
                // ìƒíƒœ í•„í„°
                if (statusFilter) {
                    const target = item.targetQty || 0;
                    const actual = item.actualQty || 0;
                    let status = 'pending';
                    
                    if (actual > target) status = 'over';
                    else if (actual === target) status = 'achieved';
                    else if (actual > 0) status = 'under';
                    
                    if (status !== statusFilter) return false;
                }
                
                return true;
            });

            updateKPIs();
            updateCharts();
            updateTable();
            updatePerformancePanels();
        }

        // KPI ì—…ë°ì´íŠ¸
        function updateKPIs() {
            // ì‹œì‘ ì£¼ì°¨ê°€ ì„¤ì •ë˜ì§€ ì•Šì€ ê²½ìš° ì²˜ë¦¬
            if (startYear === null || startWeek === null) {
                document.getElementById('totalTarget').textContent = '0';
                document.getElementById('totalScheduled').textContent = '0';
                document.getElementById('scheduledAchievementRate').textContent = '0%';
                document.getElementById('totalActual').textContent = '0';
                document.getElementById('actualAchievementRate').textContent = '0%';
                return;
            }
            
            // í•„í„°ë§ëœ ë°ì´í„°ì—ì„œ ëˆ„ì  í•©ê³„ ê³„ì‚°
            let cumulativeData = filteredData;
            
            // ì „ì²´ì£¼ì°¨ê°€ ì•„ë‹Œ ê²½ìš°ì—ë§Œ ì‹œì‘ ì£¼ì°¨ í•„í„° ì ìš©
            if (currentYear !== null && currentWeek !== null) {
                cumulativeData = filteredData.filter(item => {
                    // ì‹œì‘ ì£¼ì°¨ ì´ì „ ë°ì´í„° ì œì™¸
                    if (item.deliveryYear < startYear) return false;
                    if (item.deliveryYear === startYear && item.deliveryWeek < startWeek) return false;
                    // ì„ íƒëœ ì£¼ì°¨ ì´í›„ ë°ì´í„° ì œì™¸
                    if (item.deliveryYear > currentYear) return false;
                    if (item.deliveryYear === currentYear && item.deliveryWeek > currentWeek) return false;
                    return true;
                });
            } else {
                // ì „ì²´ì£¼ì°¨ ì„ íƒ ì‹œ ì‹œì‘ ì£¼ì°¨ ì´í›„ì˜ ëª¨ë“  ë°ì´í„°
                cumulativeData = filteredData.filter(item => {
                    if (item.deliveryYear < startYear) return false;
                    if (item.deliveryYear === startYear && item.deliveryWeek < startWeek) return false;
                    return true;
                });
            }
            
            // ì£¼ì°¨ë³„ë¡œ ê·¸ë£¹í™”í•˜ì—¬ ì¤‘ë³µ ì œê±° í›„ ëˆ„ì  í•©ê³„ ê³„ì‚°
            const weeklyGrouped = {};
            cumulativeData.forEach(item => {
                const key = `${item.deliveryYear}-${item.deliveryWeek}`;
                if (!weeklyGrouped[key]) {
                    weeklyGrouped[key] = {
                        target: 0,
                        actual: 0,
                        scheduled: 0
                    };
                }
                weeklyGrouped[key].target += item.targetQty || 0;
                weeklyGrouped[key].actual += item.actualQty || 0;
                weeklyGrouped[key].scheduled += item.scheduledQty || 0;
            });
            
            // ì „ì²´ ëˆ„ì  í•©ê³„ ê³„ì‚° (ì£¼ì°¨ë³„ í•©ê³„ì˜ í•©)
            const totalTarget = Object.values(weeklyGrouped).reduce((sum, week) => sum + (week.target || 0), 0);
            const totalActual = Object.values(weeklyGrouped).reduce((sum, week) => sum + (week.actual || 0), 0);
            let totalScheduled = Object.values(weeklyGrouped).reduce((sum, week) => sum + (week.scheduled || 0), 0);
            
            // ì¶œê³ ëŸ‰ì´ ë°œì£¼ëŸ‰ì„ ì´ˆê³¼í•˜ì§€ ì•Šë„ë¡ ì œí•œ
            // (ì¶œê³ ëŸ‰ì€ ìµœëŒ€ ë°œì£¼ëŸ‰ê¹Œì§€ ê°€ëŠ¥)
            if (totalScheduled > totalTarget) {
                totalScheduled = totalTarget;
            }
            
            // ì¶œê³  ë‹¬ì„±ë¥  = (ëˆ„ì  ì¶œê³  / ëˆ„ì  ë°œì£¼) * 100
            const scheduledAchievementRate = totalTarget > 0 ? ((totalScheduled / totalTarget) * 100).toFixed(2) : '0.00';
            // ì‹¤ ì…ê³  ë‹¬ì„±ë¥  = (ì‹¤ì œ ì…ê³  / ëˆ„ì  ë°œì£¼) * 100
            const actualAchievementRate = totalTarget > 0 ? ((totalActual / totalTarget) * 100).toFixed(2) : '0.00';

            document.getElementById('totalTarget').textContent = Math.round(totalTarget).toLocaleString();
            document.getElementById('totalScheduled').textContent = Math.round(totalScheduled).toLocaleString();
            document.getElementById('scheduledAchievementRate').textContent = scheduledAchievementRate + '%';
            document.getElementById('totalActual').textContent = Math.round(totalActual).toLocaleString();
            document.getElementById('actualAchievementRate').textContent = actualAchievementRate + '%';
        }

        // ëˆ„ì  ë°ì´í„° ê³„ì‚° (ì‹œì‘ ì£¼ì°¨ë¶€í„°)
        // filteredDataëŠ” ì´ë¯¸ applyFilters()ì—ì„œ ì£¼ì°¨ í•„í„°ê°€ ì ìš©ëœ ìƒíƒœ
        // ì „ì²´ì£¼ì°¨ ì„ íƒ ì‹œì—ëŠ” ëª¨ë“  ë°ì´í„° í¬í•¨, íŠ¹ì • ì£¼ì°¨ ì„ íƒ ì‹œì—ëŠ” ì‹œì‘ ì£¼ì°¨ ì´ìƒë§Œ í•„í„°ë§
        function calculateCumulativeData() {
            // ì‹œì‘ ì£¼ì°¨ê°€ ì„¤ì •ë˜ì§€ ì•Šì€ ê²½ìš° ì²˜ë¦¬
            if (startYear === null || startWeek === null) {
                return [];
            }
            
            // filteredDataëŠ” ì´ë¯¸ ì£¼ì°¨ í•„í„°ê°€ ì ìš©ëœ ìƒíƒœ
            // ì „ì²´ì£¼ì°¨ ì„ íƒ ì‹œ(currentYearì™€ currentWeekì´ null)ì—ëŠ” ëª¨ë“  ë°ì´í„° í¬í•¨
            // íŠ¹ì • ì£¼ì°¨ ì„ íƒ ì‹œì—ëŠ” ì‹œì‘ ì£¼ì°¨ ì´ìƒì˜ ë°ì´í„°ë§Œ í•„í„°ë§
            let currentData = filteredData;
            
            // ì „ì²´ì£¼ì°¨ê°€ ì•„ë‹Œ ê²½ìš°ì—ë§Œ ì‹œì‘ ì£¼ì°¨ í•„í„° ì ìš©
            if (currentYear !== null && currentWeek !== null) {
                currentData = filteredData.filter(item => {
                    // ì‹œì‘ ì£¼ì°¨ ì´ì „ ë°ì´í„° ì œì™¸
                    if (item.deliveryYear < startYear) return false;
                    if (item.deliveryYear === startYear && item.deliveryWeek < startWeek) return false;
                    return true;
                });
            }

            // ì£¼ì°¨ë³„ë¡œ ê·¸ë£¹í™”í•˜ì—¬ ëˆ„ì  ê³„ì‚°
            const weeklyData = {};
            currentData.forEach(item => {
                const key = `${item.deliveryYear}-${item.deliveryWeek}`;
                if (!weeklyData[key]) {
                    weeklyData[key] = {
                        year: item.deliveryYear,
                        week: item.deliveryWeek,
                        target: 0,
                        actual: 0,
                        scheduled: 0,
                        category: item.category,
                        country: item.mappedCountry,
                        vendor: item.vendor,
                        season: item.season
                    };
                }
                weeklyData[key].target += item.targetQty || 0;
                weeklyData[key].actual += item.actualQty || 0;
                weeklyData[key].scheduled += item.scheduledQty || 0;
            });

            return Object.values(weeklyData).sort((a, b) => {
                if (a.year !== b.year) return a.year - b.year;
                return a.week - b.week;
            });
        }

        // ì°¨íŠ¸ ì—…ë°ì´íŠ¸
        function updateCharts() {
            updateWeeklyChart();
            updateProductChart();
            updateCountryChart();
        }

        // ì£¼ì°¨ë³„ ì°¨íŠ¸ ì—…ë°ì´íŠ¸
        function updateWeeklyChart() {
            const ctx = document.getElementById('weeklyChart').getContext('2d');
            
            if (weeklyChart) {
                weeklyChart.destroy();
            }

            // ì „ì£¼/ê¸ˆì£¼/ì°¨ì£¼ ë°ì´í„° ê³„ì‚°
            const chartData = calculateWeeklyChartData();
            const labels = chartData.map(item => `${item.year}-${item.week}ì£¼ì°¨`);
            const targetData = chartData.map(item => Math.round(item.target));
            const actualData = chartData.map(item => Math.round(item.actual));

            weeklyChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'ëˆ„ì  ë°œì£¼',
                        data: targetData,
                        backgroundColor: 'rgba(52, 152, 219, 0.7)',
                        borderColor: 'rgba(52, 152, 219, 1)',
                        borderWidth: 1
                    }, {
                        label: 'ëˆ„ì  ì…ê³ ',
                        data: actualData,
                        backgroundColor: 'rgba(39, 174, 96, 0.7)',
                        borderColor: 'rgba(39, 174, 96, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        // ì£¼ì°¨ë³„ ì°¨íŠ¸ ë°ì´í„° ê³„ì‚° (ì „ì£¼/ê¸ˆì£¼/ì°¨ì£¼)
        function calculateWeeklyChartData() {
            // ì‹œì‘ ì£¼ì°¨ê°€ ì„¤ì •ë˜ì§€ ì•Šì€ ê²½ìš° ì²˜ë¦¬
            if (startYear === null || startWeek === null) {
                return [];
            }
            
            // ê¸ˆì£¼ ê¸°ì¤€ ì„¤ì • (í•„í„°ë§ ì£¼ì°¨ ë˜ëŠ” í˜„ì¬ ì£¼ì°¨)
            const currentWeek = document.getElementById('weekSelect').value;
            let baseYear, baseWeek;
            
            if (currentWeek) {
                [baseYear, baseWeek] = currentWeek.split('-').map(Number);
            } else {
                // í•„í„°ë§ì´ ì—†ì„ ê²½ìš° í˜„ì¬ ì£¼ì°¨ ì‚¬ìš©
                baseYear = new Date().getFullYear();
                baseWeek = getWeekNumber(new Date());
            }
            
            // ì „ì£¼/ê¸ˆì£¼/ì°¨ì£¼ ê³„ì‚°
            const weeks = [];
            
            // ì „ì£¼
            const prevWeek = getPreviousWeek(baseYear, baseWeek);
            weeks.push({
                year: prevWeek.year,
                week: prevWeek.week,
                target: 0,
                actual: 0
            });
            
            // ê¸ˆì£¼
            weeks.push({
                year: baseYear,
                week: baseWeek,
                target: 0,
                actual: 0
            });
            
            // ì°¨ì£¼
            const nextWeek = getNextWeek(baseYear, baseWeek);
            weeks.push({
                year: nextWeek.year,
                week: nextWeek.week,
                target: 0,
                actual: 0
            });
            
            // ê° ì£¼ì°¨ë³„ ëˆ„ì  ë°ì´í„° ê³„ì‚°
            weeks.forEach(weekData => {
                const cumulativeData = calculateCumulativeDataUpToWeek(weekData.year, weekData.week);
                weekData.target = cumulativeData.reduce((sum, item) => sum + (item.targetQty || 0), 0);
                weekData.actual = cumulativeData.reduce((sum, item) => sum + (item.actualQty || 0), 0);
                weekData.scheduled = cumulativeData.reduce((sum, item) => sum + (item.scheduledQty || 0), 0);
            });
            
            return weeks;
        }

        // íŠ¹ì • ì£¼ì°¨ê¹Œì§€ì˜ ëˆ„ì  ë°ì´í„° ê³„ì‚°
        function calculateCumulativeDataUpToWeek(targetYear, targetWeek) {
            // ì‹œì‘ ì£¼ì°¨ê°€ ì„¤ì •ë˜ì§€ ì•Šì€ ê²½ìš° ì²˜ë¦¬
            if (startYear === null || startWeek === null) {
                return filteredData.filter(item => {
                    if (item.deliveryYear > targetYear) return false;
                    if (item.deliveryYear === targetYear && item.deliveryWeek > targetWeek) return false;
                    return true;
                });
            }
            
            return filteredData.filter(item => {
                if (item.deliveryYear < startYear) return false;
                if (item.deliveryYear === startYear && item.deliveryWeek < startWeek) return false;
                if (item.deliveryYear > targetYear) return false;
                if (item.deliveryYear === targetYear && item.deliveryWeek > targetWeek) return false;
                return true;
            });
        }

        // ì´ì „ ì£¼ì°¨ ê³„ì‚° (2025-2026ë…„ ì§€ì›)
        function getPreviousWeek(year, week) {
            // 2026-1ì£¼ì°¨ì˜ ì „ì£¼ì°¨ëŠ” 2025-53ì£¼ì°¨
            if (year === 2026 && week === 1) {
                return { year: 2025, week: 53 };
            }
            
            // ì¼ë°˜ì ì¸ ê²½ìš°: ê°™ì€ ì—°ë„ ë‚´ì—ì„œ ì´ì „ ì£¼ì°¨
            if (week > 1) {
                return { year: year, week: week - 1 };
            } else {
                // 2025-1ì£¼ì°¨ì˜ ì´ì „ ì£¼ì°¨ëŠ” 2025-53ì£¼ì°¨ (ìˆœí™˜)
                if (year === 2025) {
                    return { year: 2025, week: 53 };
                } else {
                    // ë‹¤ë¥¸ ê²½ìš°ëŠ” ì´ì „ ì—°ë„ì˜ ë§ˆì§€ë§‰ ì£¼ì°¨
                    const prevYear = year - 1;
                    const lastWeek = getLastWeekOfYear(prevYear);
                    return { year: prevYear, week: lastWeek };
                }
            }
        }

        // ë‹¤ìŒ ì£¼ì°¨ ê³„ì‚° (2025-2026ë…„ ì§€ì›)
        function getNextWeek(year, week) {
            // 2025-53ì£¼ì°¨ì˜ ë‹¤ìŒ ì£¼ì°¨ëŠ” 2026-1ì£¼ì°¨
            if (year === 2025 && week === 53) {
                return { year: 2026, week: 1 };
            }
            
            // ì¼ë°˜ì ì¸ ê²½ìš°: ê°™ì€ ì—°ë„ ë‚´ì—ì„œ ë‹¤ìŒ ì£¼ì°¨
            if (week < 53) {
                return { year: year, week: week + 1 };
            } else {
                // 2026-53ì£¼ì°¨ì˜ ë‹¤ìŒ ì£¼ì°¨ëŠ” 2026-1ì£¼ì°¨ (ìˆœí™˜)
                if (year === 2026) {
                    return { year: 2026, week: 1 };
                } else {
                    return { year: year + 1, week: 1 };
                }
            }
        }

        // ì—°ë„ì˜ ë§ˆì§€ë§‰ ì£¼ì°¨ ê³„ì‚°
        function getLastWeekOfYear(year) {
            const dec31 = new Date(year, 11, 31);
            return getWeekNumber(dec31);
        }

        // ì£¼ì°¨ì—ì„œ ë…„/ì›”/ì¼ ì •ë³´ ê³„ì‚° (ISO Week ê¸°ì¤€)
        function getDateRangeFromWeek(year, week) {
            const startDate = getDateFromWeekNumber(year, week);
            const endDate = new Date(startDate);
            endDate.setDate(endDate.getDate() + 6);
            
            const formatDate = (date) => {
                const y = date.getFullYear();
                const m = (date.getMonth() + 1).toString().padStart(2, '0');
                const d = date.getDate().toString().padStart(2, '0');
                return `${y}/${m}/${d}`;
            };
            
            return `${formatDate(startDate)}~${formatDate(endDate)}`;
        }

        // íƒ­ ì „í™˜ í•¨ìˆ˜
        function switchTab(tabName) {
            // ëª¨ë“  íƒ­ ë²„íŠ¼ ë¹„í™œì„±í™”
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // ëª¨ë“  íƒ­ ì½˜í…ì¸  ìˆ¨ê¸°ê¸°
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // ì„ íƒëœ íƒ­ í™œì„±í™”
            document.querySelector(`[onclick="switchTab('${tabName}')"]`).classList.add('active');
            document.getElementById(`${tabName}Tab`).classList.add('active');
            
            // DELAY ì´ìŠˆ íƒ­ì¸ ê²½ìš° í•´ë‹¹ í…Œì´ë¸” ì—…ë°ì´íŠ¸
            if (tabName === 'delay') {
                updateDelayTable();
            }
        }

        // ì œí’ˆë³„ ì°¨íŠ¸ ì—…ë°ì´íŠ¸
        function updateProductChart() {
            const ctx = document.getElementById('productChart').getContext('2d');
            
            if (productChart) {
                productChart.destroy();
            }

            const productData = {};
            const categories = ['KNIT', 'SWEATER', 'WOVEN', 'DENIM'];
            
            // ê° ì œí’ˆ ì¹´í…Œê³ ë¦¬ë³„ ë°ì´í„° ì§‘ê³„
            categories.forEach(category => {
                productData[category] = { target: 0, actual: 0 };
            });

            filteredData.forEach(item => {
                const category = item.category || 'ê¸°íƒ€';
                if (categories.includes(category)) {
                    productData[category].target += item.targetQty || 0;
                    productData[category].actual += item.actualQty || 0;
                }
            });

            const labels = Object.keys(productData);
            const targetData = labels.map(label => Math.round(productData[label].target));
            const actualData = labels.map(label => Math.round(productData[label].actual));

            productChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'ë°œì£¼',
                        data: targetData,
                        backgroundColor: 'rgba(52, 152, 219, 0.7)',
                        borderColor: 'rgba(52, 152, 219, 1)',
                        borderWidth: 1
                    }, {
                        label: 'ì…ê³ ',
                        data: actualData,
                        backgroundColor: 'rgba(39, 174, 96, 0.7)',
                        borderColor: 'rgba(39, 174, 96, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        // íŒë§¤êµ­ê°€ë³„ ì°¨íŠ¸ ì—…ë°ì´íŠ¸
        function updateCountryChart() {
            const ctx = document.getElementById('countryChart').getContext('2d');
            
            if (countryChart) {
                countryChart.destroy();
            }

            const countryData = {};
            const countries = ['KR', 'CN', 'GL', 'GL_ì§ì†¡'];
            
            // ê° êµ­ê°€ë³„ ë°ì´í„° ì§‘ê³„
            countries.forEach(country => {
                countryData[country] = { target: 0, actual: 0 };
            });

            filteredData.forEach(item => {
                const mappedCountry = item.mappedCountry || 'GL_ì§ì†¡';
                if (countryData[mappedCountry]) {
                    countryData[mappedCountry].target += item.targetQty || 0;
                    countryData[mappedCountry].actual += item.actualQty || 0;
                }
            });

            const labels = Object.keys(countryData);
            const targetData = labels.map(label => Math.round(countryData[label].target));
            const actualData = labels.map(label => Math.round(countryData[label].actual));

            countryChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'ë°œì£¼',
                        data: targetData,
                        backgroundColor: 'rgba(52, 152, 219, 0.7)',
                        borderColor: 'rgba(52, 152, 219, 1)',
                        borderWidth: 1
                    }, {
                        label: 'ì…ê³ ',
                        data: actualData,
                        backgroundColor: 'rgba(39, 174, 96, 0.7)',
                        borderColor: 'rgba(39, 174, 96, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        // í…Œì´ë¸” ì—…ë°ì´íŠ¸
        function updateTable() {
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';

            // í•„í„°ëœ ì£¼ì°¨ ê¸°ì¤€ìœ¼ë¡œ ë°ì´í„° ê³„ì‚°
            const tableData = calculateTableData();
            
            // í˜‘ë ¥ì‚¬ë³„ë¡œ ê·¸ë£¹í™”í•˜ì—¬ í‘œì‹œ
            let currentVendor = null;
            let vendorCount = 0;
            const vendorSet = new Set();
            
            tableData.forEach((item, index) => {
                const target = Math.round(item.target || 0);
                const actual = Math.round(item.actual || 0);
                const scheduled = Math.round(item.scheduled || 0);
                const achievementRate = target > 0 ? ((actual / target) * 100).toFixed(2) : '0.00';
                const variance = Math.round(actual - target);
                
                // í˜‘ë ¥ì‚¬ê°€ ë³€ê²½ë˜ë©´ í—¤ë” í–‰ ì¶”ê°€
                if (currentVendor !== item.vendor) {
                    currentVendor = item.vendor;
                    if (!vendorSet.has(currentVendor)) {
                        vendorSet.add(currentVendor);
                        vendorCount++;
                        
                        // í˜‘ë ¥ì‚¬ í—¤ë” í–‰ ì¶”ê°€
                        const headerRow = document.createElement('tr');
                        headerRow.className = 'vendor-header';
                        headerRow.innerHTML = `
                            <td colspan="11" style="background-color: #f0f0f0; font-weight: bold; padding: 10px; border-top: 2px solid #ddd;">
                                ğŸ“‹ ${currentVendor || 'ë¯¸ë¶„ë¥˜'} (${tableData.filter(d => d.vendor === currentVendor).length}ê°œ ì£¼ì°¨)
                            </td>
                        `;
                        tbody.appendChild(headerRow);
                    }
                }
                
                let status = 'pending';
                let statusClass = 'status-pending';
                if (actual > target) {
                    status = 'ì´ˆê³¼';
                    statusClass = 'status-over';
                } else if (actual === target) {
                    status = 'ë‹¬ì„±';
                    statusClass = 'status-achieved';
                } else if (actual > 0) {
                    status = 'ë¯¸ë‹¬';
                    statusClass = 'status-under';
                } else {
                    status = 'ì˜ˆì •';
                }

                // ì£¼ì°¨ì— ë…„/ì›”/ì¼ ì •ë³´ ì¶”ê°€ (2025-2026ë…„ ISO Week ê¸°ì¤€)
                const dateRange = getDateRangeFromWeek(item.year, item.week);
                const weekLabel = item.label ? `<br><small style="color: #999; font-weight: normal;">(${item.label})</small>` : '';

                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item.year}-${item.week}ì£¼ì°¨${weekLabel}<br><small style="color: #666;">${dateRange}</small></td>
                    <td>${item.category || '-'}</td>
                    <td>${item.mappedCountry || '-'}</td>
                    <td>${item.vendor || '-'}</td>
                    <td>${item.season || '-'}</td>
                    <td class="number">${target.toLocaleString()}</td>
                    <td class="number">${scheduled.toLocaleString()}</td>
                    <td class="number">${actual.toLocaleString()}</td>
                    <td class="number">${achievementRate}%</td>
                    <td class="number">${variance.toLocaleString()}</td>
                    <td class="${statusClass}">${status}</td>
                `;
                
                tbody.appendChild(row);
            });

            document.getElementById('tableCount').textContent = `ì´ ${tableData.length}ê°œ ì£¼ì°¨ (${vendorCount}ê°œ í˜‘ë ¥ì‚¬)`;
        }

        // í…Œì´ë¸”ìš© ë°ì´í„° ê³„ì‚° (í•„í„°ëœ ì£¼ì°¨ ê¸°ì¤€)
        function calculateTableData() {
            // ì‹œì‘ ì£¼ì°¨ê°€ ì„¤ì •ë˜ì§€ ì•Šì€ ê²½ìš° ì²˜ë¦¬
            if (startYear === null || startWeek === null) {
                return [];
            }
            
            // í˜‘ë ¥ì‚¬ í•„í„° í™•ì¸
            const vendorFilter = document.getElementById('vendorFilter').value;
            
            // í˜‘ë ¥ì‚¬ í•„í„°ê°€ ì ìš©ëœ ê²½ìš°, í•´ë‹¹ í˜‘ë ¥ì‚¬ì˜ ë°ì´í„°ë§Œ ì‚¬ìš©
            let baseData = filteredData;
            if (vendorFilter) {
                baseData = filteredData.filter(item => item.vendor === vendorFilter);
            }
            
            // ì„ íƒí•œ ì£¼ì°¨ ê¸°ì¤€ìœ¼ë¡œ ì „ì£¼/ê¸ˆì£¼/ì°¨ì£¼ë§Œ í‘œì‹œ
            const currentWeek = document.getElementById('weekSelect').value;
            let baseYear, baseWeek;
            
            if (currentWeek && currentYear !== null && currentWeek !== null) {
                [baseYear, baseWeek] = currentWeek.split('-').map(Number);
            } else if (currentYear !== null && currentWeek !== null) {
                baseYear = currentYear;
                baseWeek = currentWeek;
            } else {
                // ì£¼ì°¨ê°€ ì„ íƒë˜ì§€ ì•Šì€ ê²½ìš° í˜„ì¬ ì£¼ì°¨ ì‚¬ìš©
                baseYear = new Date().getFullYear();
                baseWeek = getWeekNumber(new Date());
            }
            
            // ì „ì£¼/ê¸ˆì£¼/ì°¨ì£¼ ê³„ì‚°
            const prevWeek = getPreviousWeek(baseYear, baseWeek);
            const nextWeek = getNextWeek(baseYear, baseWeek);
            
            const targetWeeks = [
                { year: prevWeek.year, week: prevWeek.week, label: 'ì´ì „ì£¼' },
                { year: baseYear, week: baseWeek, label: 'ì„ íƒí•œ ì£¼' },
                { year: nextWeek.year, week: nextWeek.week, label: 'ë‹¤ìŒì£¼' }
            ];
            
            // ì£¼ì°¨ë³„ + í˜‘ë ¥ì‚¬ë³„ë¡œ ê·¸ë£¹í™”í•˜ì—¬ ëˆ„ì  ê³„ì‚°
            const weeklyData = {};
            
            targetWeeks.forEach(targetWeek => {
                // í•´ë‹¹ ì£¼ì°¨ì˜ ë°ì´í„°ë§Œ í•„í„°ë§ (í˜‘ë ¥ì‚¬ë³„ë¡œ ê·¸ë£¹í™”í•˜ê¸° ìœ„í•´)
                const weekData = baseData.filter(item => 
                    item.deliveryYear === targetWeek.year && item.deliveryWeek === targetWeek.week
                );
                
                // í•´ë‹¹ ì£¼ì°¨ì— ë°ì´í„°ê°€ ìˆëŠ” í˜‘ë ¥ì‚¬ë“¤ ì¶”ì¶œ
                const vendorsInWeek = [...new Set(weekData.map(item => item.vendor))];
                
                // ê° í˜‘ë ¥ì‚¬ë³„ë¡œ ëˆ„ì  ê³„ì‚°
                vendorsInWeek.forEach(vendor => {
                    const weekKey = `${targetWeek.year}-${targetWeek.week}-${vendor}`;
                    
                    // í•´ë‹¹ í˜‘ë ¥ì‚¬ì˜ ì‹œì‘ ì£¼ì°¨ë¶€í„° í•´ë‹¹ ì£¼ì°¨ê¹Œì§€ì˜ ë°ì´í„° í•„í„°ë§ (ëˆ„ì  ê³„ì‚°ìš©)
                    const cumulativeData = baseData.filter(item => {
                        // í•´ë‹¹ í˜‘ë ¥ì‚¬ë§Œ
                        if (item.vendor !== vendor) return false;
                        // ì‹œì‘ ì£¼ì°¨ ì´ì „ ë°ì´í„° ì œì™¸
                        if (item.deliveryYear < startYear) return false;
                        if (item.deliveryYear === startYear && item.deliveryWeek < startWeek) return false;
                        // í•´ë‹¹ ì£¼ì°¨ ì´í›„ ë°ì´í„° ì œì™¸
                        if (item.deliveryYear > targetWeek.year) return false;
                        if (item.deliveryYear === targetWeek.year && item.deliveryWeek > targetWeek.week) return false;
                        return true;
                    });
                    
                    // í•´ë‹¹ ì£¼ì°¨ì˜ í•´ë‹¹ í˜‘ë ¥ì‚¬ ë°ì´í„°ë§Œ í•„í„°ë§ (ì •ë³´ í‘œì‹œìš©)
                    const vendorWeekData = weekData.filter(item => item.vendor === vendor);
                    
                    // ì£¼ì°¨ë³„ + í˜‘ë ¥ì‚¬ë³„ë¡œ ê·¸ë£¹í™”í•˜ì—¬ í•©ê³„ ê³„ì‚°
                    weeklyData[weekKey] = {
                        year: targetWeek.year,
                        week: targetWeek.week,
                        label: targetWeek.label,
                        target: 0,
                        actual: 0,
                        scheduled: 0,
                        category: vendorWeekData[0]?.category || '-',
                        country: vendorWeekData[0]?.mappedCountry || '-',
                        vendor: vendor,
                        season: vendorWeekData[0]?.season || '-'
                    };
                    
                    // ëˆ„ì  ê³„ì‚° (ì‹œì‘ ì£¼ì°¨ë¶€í„° í•´ë‹¹ ì£¼ì°¨ê¹Œì§€, í•´ë‹¹ í˜‘ë ¥ì‚¬ë§Œ)
                    cumulativeData.forEach(item => {
                        weeklyData[weekKey].target += item.targetQty || 0;
                        weeklyData[weekKey].actual += item.actualQty || 0;
                        weeklyData[weekKey].scheduled += item.scheduledQty || 0;
                    });
                });
            });

            // í˜‘ë ¥ì‚¬ë³„ë¡œ ê·¸ë£¹í™”
            const vendorGroups = {};
            Object.values(weeklyData).forEach(item => {
                const vendor = item.vendor || 'ë¯¸ë¶„ë¥˜';
                if (!vendorGroups[vendor]) {
                    vendorGroups[vendor] = [];
                }
                vendorGroups[vendor].push(item);
            });
            
            // ê° í˜‘ë ¥ì‚¬ë³„ë¡œ ì£¼ì°¨ ì •ë ¬
            Object.keys(vendorGroups).forEach(vendor => {
                vendorGroups[vendor].sort((a, b) => {
                    if (a.year !== b.year) return a.year - b.year;
                    return a.week - b.week;
                });
            });
            
            // í˜‘ë ¥ì‚¬ë³„ë¡œ ì •ë ¬ëœ ê²°ê³¼ ë°˜í™˜
            const result = [];
            Object.keys(vendorGroups).sort().forEach(vendor => {
                result.push(...vendorGroups[vendor]);
            });
            
            return result;
        }

        // DELAY ì´ìŠˆ í…Œì´ë¸” ì—…ë°ì´íŠ¸
        function updateDelayTable() {
            const tbody = document.getElementById('delayTableBody');
            tbody.innerHTML = '';

            // í•„í„°ëœ ì£¼ì°¨ ê¸°ì¤€ìœ¼ë¡œ ë°ì´í„° ê³„ì‚°
            const tableData = calculateTableData();
            
            // DELAY ì´ìŠˆë§Œ í•„í„°ë§ (ë¯¸ë‹¬ì„± ë˜ëŠ” ì˜ˆì • ìƒíƒœ)
            const delayData = tableData.filter(item => {
                const target = item.target || 0;
                const actual = item.actual || 0;
                return actual < target; // ë¯¸ë‹¬ì„± ë˜ëŠ” ì˜ˆì •
            });
            
            delayData.forEach(item => {
                const row = document.createElement('tr');
                const target = Math.round(item.target || 0);
                const actual = Math.round(item.actual || 0);
                const scheduled = Math.round(item.scheduled || 0);
                const achievementRate = target > 0 ? ((actual / target) * 100).toFixed(2) : '0.00';
                const variance = Math.round(actual - target);
                
                let status = 'pending';
                let statusClass = 'status-pending';
                if (actual > 0) {
                    status = 'ë¯¸ë‹¬';
                    statusClass = 'status-under';
                } else {
                    status = 'ì˜ˆì •';
                }

                // ì£¼ì°¨ì— ë…„/ì›”/ì¼ ì •ë³´ ì¶”ê°€ (2025-2026ë…„ ISO Week ê¸°ì¤€)
                const dateRange = getDateRangeFromWeek(item.year, item.week);

                row.innerHTML = `
                    <td>${item.year}-${item.week}ì£¼ì°¨<br><small style="color: #666;">${dateRange}</small></td>
                    <td>${item.category || '-'}</td>
                    <td>${item.mappedCountry || '-'}</td>
                    <td>${item.vendor || '-'}</td>
                    <td>${item.season || '-'}</td>
                    <td class="number">${target.toLocaleString()}</td>
                    <td class="number">${scheduled.toLocaleString()}</td>
                    <td class="number">${actual.toLocaleString()}</td>
                    <td class="number">${achievementRate}%</td>
                    <td class="number">${variance.toLocaleString()}</td>
                    <td class="${statusClass}">${status}</td>
                `;
                
                tbody.appendChild(row);
            });
        }

        // ì£¼ì°¨ ë„¤ë¹„ê²Œì´ì…˜
        function navigateWeek(direction) {
            if (!currentWeek || !currentYear) return;

            const weeks = [...new Set(uploadedData.map(item => `${item.deliveryYear}-${item.deliveryWeek}`))].sort();
            const currentIndex = weeks.indexOf(`${currentYear}-${currentWeek}`);
            
            if (direction === 0) {
                // í˜„ì¬ì£¼ë¡œ ì´ë™ (ìµœì‹  ë‚©ê¸° ì£¼ì°¨)
                const latestDeliveryWeek = Math.max(...uploadedData.map(item => item.deliveryWeek));
                const latestDeliveryYear = Math.max(...uploadedData.map(item => item.deliveryYear));
                currentWeek = latestDeliveryWeek;
                currentYear = latestDeliveryYear;
            } else {
                const newIndex = currentIndex + direction;
                if (newIndex >= 0 && newIndex < weeks.length) {
                    const [year, week] = weeks[newIndex].split('-');
                    currentYear = parseInt(year);
                    currentWeek = parseInt(week);
                }
            }

            document.getElementById('weekSelect').value = `${currentYear}-${currentWeek}`;
            updateHeaderInfo();
            applyFilters();
        }

        // ì£¼ì°¨ ì„ íƒ
        function selectWeek() {
            const value = document.getElementById('weekSelect').value;
            if (value) {
                if (value === 'all') {
                    // ì „ì²´ì£¼ì°¨ ì„ íƒ ì‹œ
                    currentYear = null;
                    currentWeek = null;
                    document.getElementById('currentWeekDisplay').textContent = 'ì „ì²´ì£¼ì°¨';
                    document.getElementById('dateRangeDisplay').textContent = '';
                } else {
                    const [year, week] = value.split('-');
                    currentYear = parseInt(year);
                    currentWeek = parseInt(week);
                    updateHeaderInfo();
                }
                applyFilters();
            }
        }

        // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤
        function updateSelectOptions(selectId, options) {
            const select = document.getElementById(selectId);
            const currentValue = select.value;
            select.innerHTML = '<option value="">ì „ì²´</option>';
            
            options.forEach(option => {
                const optionElement = document.createElement('option');
                optionElement.value = option;
                optionElement.textContent = option;
                select.appendChild(optionElement);
            });
            
            if (options.includes(currentValue)) {
                select.value = currentValue;
            }
        }

        function showLoading(show) {
            document.getElementById('loadingSpinner').style.display = show ? 'block' : 'none';
        }

        function showAlert(message, type) {
            const container = document.getElementById('alertContainer');
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.textContent = message;
            
            container.innerHTML = '';
            container.appendChild(alert);
            
            setTimeout(() => {
                alert.remove();
            }, 5000);
        }

        // ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì´ë²¤íŠ¸
        document.addEventListener('DOMContentLoaded', function() {
            const uploadArea = document.querySelector('.compact-upload');
            
            uploadArea.addEventListener('dragover', function(e) {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });
            
            uploadArea.addEventListener('dragleave', function(e) {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
            });
            
            uploadArea.addEventListener('drop', function(e) {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    const fileInput = document.getElementById('fileInput');
                    fileInput.files = files;
                    handleFileUpload({ target: { files: files } });
                }
            });
        });
    </script>
</body>
</html>
